<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Technical Appendix – Philadelphia Housing Price Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Philadelphia Housing Price Prediction</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../presentation/presentation.html"> 
<span class="menu-text">Presentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../appendix/appendix.html" aria-current="page"> 
<span class="menu-text">Technical Appendix</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Technical Appendix</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors

载入程序包：'scales'


The following object is masked from 'package:purrr':

    discard


The following object is masked from 'package:readr':

    col_factor


Linking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE

To enable caching of data, set `options(tigris_use_cache = TRUE)`
in your R script or .Rprofile.

here() starts at C:/Users/wensh/Desktop/MUSA5080-Midterm

Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright.
Check the package website, https://docs.ropensci.org/osmextract/, for more details.

载入需要的程序包：spatstat.data

载入需要的程序包：spatstat.univar

spatstat.univar 3.1-4

spatstat.geom 3.6-0


载入程序包：'spatstat.geom'


The following object is masked from 'package:patchwork':

    area


The following object is masked from 'package:scales':

    rescale


载入需要的程序包：spatstat.random

spatstat.random 3.4-2

载入需要的程序包：spatstat.explore

载入需要的程序包：nlme


载入程序包：'nlme'


The following object is masked from 'package:dplyr':

    collapse


spatstat.explore 3.5-3

载入需要的程序包：spatstat.model

载入需要的程序包：rpart

spatstat.model 3.4-2

载入需要的程序包：spatstat.linnet

spatstat.linnet 3.3-2


spatstat 3.4-1 
For an introduction to spatstat, type 'beginner' 


terra 1.8.60


载入程序包：'terra'


The following objects are masked from 'package:spatstat.geom':

    area, delaunay, is.empty, rescale, rotate, shift, where.max,
    where.min


The following object is masked from 'package:patchwork':

    area


The following object is masked from 'package:tigris':

    blocks


The following object is masked from 'package:scales':

    rescale


The following object is masked from 'package:knitr':

    spin


The following object is masked from 'package:tidyr':

    extract



载入程序包：'jsonlite'


The following object is masked from 'package:purrr':

    flatten



Please cite as: 


 Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables.

 R package version 5.2.3. https://CRAN.R-project.org/package=stargazer 


载入需要的程序包：carData


载入程序包：'car'


The following object is masked from 'package:spatstat.model':

    bc


The following object is masked from 'package:spatstat.geom':

    ellipse


The following object is masked from 'package:dplyr':

    recode


The following object is masked from 'package:purrr':

    some


载入需要的程序包：zoo


载入程序包：'zoo'


The following object is masked from 'package:terra':

    time&lt;-


The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
</div>
<section id="phase-1-data-preparation" class="level1">
<h1>PHASE 1: DATA PREPARATION</h1>
<section id="load-and-philadelphia-house-sales-data" class="level2">
<h2 class="anchored" data-anchor-id="load-and-philadelphia-house-sales-data">1.1 Load and Philadelphia house sales data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Philly Property Sales data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>phl_sales <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"opa_properties_public.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 583776 Columns: 79
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (38): basements, beginning_point, book_and_page, building_code, buildin...
dbl  (31): objectid, category_code, census_tract, depth, exempt_building, ex...
lgl   (7): cross_reference, date_exterior_condition, mailing_address_2, mark...
dttm  (3): assessment_date, recording_date, sale_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<section id="filter-to-residential-properties-2023-2024-sales" class="level3">
<h3 class="anchored" data-anchor-id="filter-to-residential-properties-2023-2024-sales">Filter to residential properties, 2023-2024 sales</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data types</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(phl_sales)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>phl_sales_res_23_24 <span class="ot">&lt;-</span> phl_sales <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    category_code <span class="sc">==</span> <span class="dv">1</span>, <span class="co"># Residential</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">year</span>(sale_date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2023</span>, <span class="dv">2024</span>), <span class="co"># 2023-24 sales</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(category_code) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sale_date) <span class="co"># Handle nulls</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="remove-obvious-errors" class="level3">
<h3 class="anchored" data-anchor-id="remove-obvious-errors">Remove obvious errors</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>phl_sales_clean <span class="ot">&lt;-</span> phl_sales_res_23_24 <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some sale_price are unrealistically too low ($0, $1 etc.)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    sale_price <span class="sc">&gt;=</span> <span class="dv">10000</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude homes with 0 bathrooms</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    number_of_bathrooms <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some areas are unrealistically low (0, 1, etc.)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    total_area <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some 0's remain in total_liveable_area after first area filter</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    total_livable_area <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter our unrealistic year built</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    year_built <span class="sc">&gt;=</span> <span class="dv">1750</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    ) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="handle-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="handle-missing-values">Handle missing values</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many features have NA values</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(is.na(phl_sales_clean$number_of_bedrooms))</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(is.na(phl_sales_clean$number_of_bathrooms))</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(is.na(phl_sales_clean$total_livable_area))</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(is.na(phl_sales_clean$year_built))</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the 2 observations with NA values for number of bedrooms</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>phl_sales_clean <span class="ot">&lt;-</span> phl_sales_clean <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(number_of_bedrooms)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="preliminary-feature-engineering-age-sale-date---year-built" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-feature-engineering-age-sale-date---year-built">Preliminary Feature Engineering: Age = sale date - year built</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>phl_sales_clean <span class="ot">&lt;-</span> phl_sales_clean <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sale_year =</span> <span class="fu">year</span>(sale_date),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> sale_year <span class="sc">-</span> year_built</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="document-all-cleaning-decisions" class="level3">
<h3 class="anchored" data-anchor-id="document-all-cleaning-decisions">Document all cleaning decisions</h3>
<ul>
<li><p>Our methodology for cleaning the Philadelphia home sales data is to focus on the features used in our model. As a group, we decided on the following independent variables to consider in our data exploration and model building to be: number of bathrooms, number of bedrooms, total livable area, and year built. We recognize that there is some risk of collinearity between these structural features, which will later be monitored and addressed if needed in the model building stage. Additionally, we also had to clean the sales price column since this is the variable we aim to predict in our model.</p></li>
<li><p>Filter for only <strong>residential properties</strong> &amp; <strong>sales made in 2023-24</strong> (per instructions).</p></li>
<li><p>Filter for <strong>realistic sales price</strong> &gt;= $10,000.</p></li>
<li><p>Filter for houses with <strong>at least 1 bathroom</strong>. We will keep observations where <strong>number of bedrooms = 0</strong> as this likely signifies a studio apartment. However, it is not feasible for homes to have zero bathrooms, so we will enforce a constraint that a home must have at least 1 bathroom to preserve data integrity.</p></li>
<li><p>Filter for <strong>realistic total area</strong> &gt; 1 sq ft &amp; <strong>realistic total livable area</strong> &gt; 0 sq ft.</p></li>
<li><p>Filter for <strong>year built</strong> &gt;= 1750 (some homes were built in year 0).</p></li>
<li><p><strong>Handle missing values:</strong> We removed any missing values in our dependent variable of sales price, since it is crucial we have a true and accurate measure for prediction. We also checked which of our predictor variables had NA values after filtering. Only number of bedrooms had 2 remaining NA values. The rest had no NA values. To remedy this, we will remove the 2 observations from our data. Note, if there was substantial missing values in our predictors, we could use strategies such as imputing the NA values with the mean or median to use when building our model.</p></li>
<li><p><strong>Preliminary feature engineering:</strong> Rather than using year built in our Automated Valuation Model, it makes more sense to create a new variable <strong>age</strong> that is equal to the sale date minus the year built. The <strong>age</strong> variable is often easier to interpret in exploratory plots with the newer houses appearing on the left and older ones on the right. This is primarily a stylistic preference: the overall pattern of the data will remain the same but mirrored.</p></li>
</ul>
</section>
</section>
<section id="load-secondary-data" class="level2">
<h2 class="anchored" data-anchor-id="load-secondary-data">1.2 Load Secondary Data</h2>
<section id="census" class="level3">
<h3 class="anchored" data-anchor-id="census">Census</h3>
<p>Purpose: Pull demographic and housing data at the census tract level for Philadelphia from the 2023 5-year ACS. This data will provide predictors for neighborhood characteristics in our modeling.</p>
<p>Variables Collected:</p>
<p>Median household income (B19013)</p>
<p>Percentage of family households (B11001)</p>
<p>Education attainment: percent of population 25+ with a bachelor’s degree or higher (B15003)</p>
<p>Housing vacancy rate (B25002)</p>
<p>Racial composition: percent white (B02001)</p>
<section id="load-philly-census-data-from-previously-retrieved-files" class="level4">
<h4 class="anchored" data-anchor-id="load-philly-census-data-from-previously-retrieved-files">Load Philly Census Data from Previously Retrieved Files</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative to project root</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>census_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Philly Census"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>census_csv_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(census_path, <span class="st">"philly_tract_metrics.csv"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>census_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(census_path, <span class="st">"philly_tract.shp"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Csv with census tract Geo IDs and metrics</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>philly_censustract <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(census_csv_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Shp File including geometry</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>philly_tract_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(census_shp_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="observe-summary-statistics-from-target-metrics.x" class="level4">
<h4 class="anchored" data-anchor-id="observe-summary-statistics-from-target-metrics.x">Observe Summary Statistics from target metrics.x</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>numeric_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"median_income"</span>, <span class="st">"pct_white"</span>, <span class="st">"pct_bachelors"</span>, <span class="st">"pct_vacant"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>philly_censustract <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(numeric_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> median_income      pct_white      pct_bachelors      pct_vacant     
 Min.   : 13721   Min.   : 0.000   Min.   : 1.504   Min.   :  0.000  
 1st Qu.: 42469   1st Qu.: 8.826   1st Qu.:16.094   1st Qu.:  5.366  
 Median : 60817   Median :34.740   Median :28.426   Median :  8.516  
 Mean   : 66877   Mean   :37.944   Mean   :36.325   Mean   :  9.844  
 3rd Qu.: 85298   3rd Qu.:64.202   3rd Qu.:55.345   3rd Qu.: 12.801  
 Max.   :192727   Max.   :95.513   Max.   :96.632   Max.   :100.000  
 NA's   :27       NA's   :17       NA's   :17       NA's   :19       </code></pre>
</div>
</div>
<p>A quick check of the census variables reveals some missing values and lower than epected values in median income. We will note this information but retain the missing values for now to maintain the full pitcure of census blocks.</p>
</section>
</section>
<section id="cleaning-methodology-census" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-methodology-census">Cleaning Methodology (Census)</h3>
<p>Median income: Selected only the estimate column and renamed it for clarity.</p>
<p>Household composition: Pivoted ACS table to wide format, then calculated total households and family households.</p>
<p>Education: Pivoted to wide format, summed relevant categories to compute percent of population with a bachelor’s degree or higher.</p>
<p>Vacancy: Pivoted to wide format, calculated percent of homes vacant (vacant_units / total_units * 100).</p>
<p>Racial composition: Pivoted to wide format, computed percent white.</p>
<p>Merging: Combined all datasets by GEOID to create a single dataframe philly_blockgroup with all variables.</p>
<p>Geometry: Pulled census tract shapefiles with ACS geometry and merged with philly_blockgroup to create philly_bg_map.</p>
</section>
<section id="neighborhood-polygon" class="level3">
<h3 class="anchored" data-anchor-id="neighborhood-polygon">Neighborhood (Polygon)</h3>
<p>Reading in Philadelphia Neighborhoods as a shp object. This will allow us to aggregate data on neighborhoods to identify catagorical metrics.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>neighborhood_folder <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"philadelphia-neighborhoods"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>neighborhood_path   <span class="ot">&lt;-</span> <span class="fu">file.path</span>(neighborhood_folder, <span class="st">"philadelphia-neighborhoods.shp"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the shapefile</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>philly_neighborhoods <span class="ot">&lt;-</span> <span class="fu">st_read</span>(neighborhood_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(philly_neighborhoods)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 5 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -75.23049 ymin: 39.98491 xmax: -75.0156 ymax: 40.11269
Geodetic CRS:  WGS 84
             NAME         LISTNAME         MAPNAME Shape_Leng Shape_Area
1      BRIDESBURG       Bridesburg      Bridesburg   27814.55   44586264
2       BUSTLETON        Bustleton       Bustleton   48868.46  114050424
3      CEDARBROOK       Cedarbrook      Cedarbrook   20021.42   24871745
4   CHESTNUT_HILL    Chestnut Hill   Chestnut Hill   56394.30   79664975
5      EAST_FALLS       East Falls      East Falls   27400.78   40576888
6 MOUNT_AIRY_EAST Mount Airy, East East Mount Airy   28845.55   43152470
                        geometry
1 POLYGON ((-75.06773 40.0054...
2 POLYGON ((-75.0156 40.09487...
3 POLYGON ((-75.18848 40.0727...
4 POLYGON ((-75.21221 40.0860...
5 POLYGON ((-75.18476 40.0282...
6 POLYGON ((-75.18087 40.0432...</code></pre>
</div>
</div>
</section>
<section id="commercial-and-office-points-of-interests-amenitiesalternative-at-line-360-if-you-do-not-want-to-download-pbf-data" class="level3">
<h3 class="anchored" data-anchor-id="commercial-and-office-points-of-interests-amenitiesalternative-at-line-360-if-you-do-not-want-to-download-pbf-data">Commercial and office points of interests (Amenities)(alternative at line 360 if you do not want to download pbf data)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># downloading osm data from geofabrik:https://download.geofabrik.de/north-america/us-northeast.html</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#input_pbf &lt;- "the pdf file downloaded from the link above"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get boundary of Philadelphia County</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>pa_counties <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"PA"</span>, <span class="at">year =</span> <span class="dv">2023</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to Philadelphia County</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>philly_boundary <span class="ot">&lt;-</span> <span class="fu">subset</span>(pa_counties, NAME <span class="sc">==</span> <span class="st">"Philadelphia"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># read the full OSM PBF (you can select layer types like points, lines, polygons)</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">oe_read</span>(input_pbf, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">boundary =</span> philly_boundary, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">boundary_type =</span> <span class="st">"clipsrc"</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">"points"</span>)  <span class="co"># or "lines" / "multipolygons"</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"shop"</span>,<span class="st">"amenity"</span>,<span class="st">"office"</span>,<span class="st">"historic"</span>,<span class="st">"tourism"</span>,<span class="st">"healthcare"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">"building"</span>,<span class="st">"leisure"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(keywords, <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Filter by 'other_tags' ====</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"other_tags"</span> <span class="sc">%in%</span> <span class="fu">names</span>(poi)) {</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  poi<span class="sc">$</span>other_tags <span class="ot">&lt;-</span> <span class="fu">iconv</span>(<span class="fu">as.character</span>(poi<span class="sc">$</span>other_tags), <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  poi<span class="sc">$</span>other_tags[<span class="fu">is.na</span>(poi<span class="sc">$</span>other_tags)] <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  poi_filtered <span class="ot">&lt;-</span> poi <span class="sc">%&gt;%</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(pattern, other_tags, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"filtered POIs found:"</span>, <span class="fu">nrow</span>(poi_filtered), <span class="st">"of"</span>, <span class="fu">nrow</span>(poi), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>###Alternative: filtered POI if you donot want to download osm data</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>poi_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"filtered poi"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>poi_shp_path<span class="ot">=</span><span class="fu">file.path</span>(poi_path, <span class="st">"philadelphia_poi_filtered.shp"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>poi<span class="ot">=</span><span class="fu">st_read</span>(poi_shp_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `philadelphia_poi_filtered' from data source 
  `C:\Users\wensh\Desktop\MUSA5080-Midterm\data\filtered poi\philadelphia_poi_filtered.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 11161 features and 10 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.27472 ymin: 39.87383 xmax: -74.95777 ymax: 40.13445
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="kernel-density-rasters-economic-activities-density" class="level3">
<h3 class="anchored" data-anchor-id="kernel-density-rasters-economic-activities-density">Kernel Density Rasters (Economic activities density)</h3>
<p>Instead of using distance to CBD, we extracted commercial and office points of interests from OpenStreetMap (OSM), and we opreate a Kernel Density Estimation (KDE) with a bandwidth of 300 meters. By doing that, we manage to get a surface of density of economic activities across the whole city. The higher the KDE value is, the more economic activities it will be, implying a higher likelyhood of the area as a city centers.</p>
<p>There are several benefits using this approach compared to distance to CBD. First, with the development of suburbanization, even within the context of Philadelphia County, there is still a shift from monocentric model to polycentric model, meaning there multiple centers/subcenters. Using one CBD fail to capture these subcenters, which may also influence housing price. Second, CBD is an area rather than a point, distance method fail to capture this while the continuous surface computed by KDE would have a value of economic activities across the whole city.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get boundary of Philadelphia County</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>pa_counties <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"PA"</span>, <span class="at">year =</span> <span class="dv">2023</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to Philadelphia County</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>philly_boundary <span class="ot">&lt;-</span> <span class="fu">subset</span>(pa_counties, NAME <span class="sc">==</span> <span class="st">"Philadelphia"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>philly_boundary <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(philly_boundary, <span class="dv">2272</span>)  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">2272</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Prepare point pattern ====</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert sf points to spatstat ppp object</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>win <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(philly_boundary))  <span class="co"># window from county boundary</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(poi)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coords[,<span class="dv">1</span>], <span class="at">y =</span> coords[,<span class="dv">2</span>], <span class="at">window =</span> win)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Run Kernel Density Estimation ====</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sigma = bandwidth in map units (here, meters)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>density_map <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(pp, <span class="at">sigma =</span> <span class="dv">300</span><span class="sc">*</span> <span class="fl">3.28084</span>, <span class="at">edge =</span> <span class="cn">TRUE</span>, <span class="at">at =</span> <span class="st">"pixels"</span>,<span class="at">eps =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Convert to raster ====</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>r_Economic <span class="ot">&lt;-</span> <span class="fu">rast</span>(density_map)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(r_Economic) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(philly_boundary)<span class="sc">$</span>proj4string</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>r_Economic <span class="ot">&lt;-</span> <span class="fu">mask</span>(r_Economic, <span class="fu">vect</span>(philly_boundary))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="education" class="level3">
<h3 class="anchored" data-anchor-id="education">Education</h3>
<p>We used two datasets from OpenDataPhilly.com to identify schools geolocation and populated the metrics off Attendance percent and Withdrawal volumes from those schools.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative to project root</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>education_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Education"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>education_csv_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(education_path, <span class="st">"philadelphia_schools.csv"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>education_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(education_path, <span class="st">"Schools Shape"</span>, <span class="st">"Schools.shp"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Csv with School Names and metrics</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>philly_schools <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(education_csv_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Shp File including geometry</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>philly_schools_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(education_shp_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We joined the csv file containing the metrics with the shp file containing geoloaction.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Joining Schools csv metrics to shp file. Joined on 'location_i' (shp) and 'School_code (csv)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Keeping metrics for Attendance and Withdrawals</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select relevant metrics from CSV</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>school_metrics <span class="ot">&lt;-</span> philly_schools <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(School_code, Attendance, Withdrawals) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_code =</span> <span class="fu">as.character</span>(School_code))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>philly_schools_sf <span class="ot">&lt;-</span> philly_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(school_metrics,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"location_i"</span> <span class="ot">=</span> <span class="st">"School_code"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>philly_schools_sf_clean <span class="ot">&lt;-</span> philly_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Attendance) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Withdrawals))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(philly_schools_sf_clean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "aun"         "school_num"  "location_i"  "school_nam"  "school_n_1" 
 [6] "street_add"  "zip_code"    "phone_numb"  "grade_leve"  "grade_org"  
[11] "enrollment"  "type"        "type_speci"  "objectid"    "Attendance" 
[16] "Withdrawals" "geometry"   </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(philly_schools_sf_clean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 204</code></pre>
</div>
</div>
<p>Once joined, we dropped rows that did not have values in Attendance and Withdrawal. This resulted in 204 public schools and their metrics located in Philadelphia City Limits.</p>
<p>###Tree density Location of trees data was extracted from Opendata Philly. A Kernel Density Estimation was used to estimate the density of trees. The higher the value is, the more trees there will be in this (and surronding) cell</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tree_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"ppr_tree_inventory_2024"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>tree_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(tree_path, <span class="st">"ppr_tree_inventory_2024.shp"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>trees<span class="ot">=</span><span class="fu">st_read</span>(tree_shp_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ppr_tree_inventory_2024' from data source 
  `C:\Users\wensh\Desktop\MUSA5080-Midterm\data\ppr_tree_inventory_2024\ppr_tree_inventory_2024.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 151713 features and 6 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -8380434 ymin: 4847791 xmax: -8344373 ymax: 4885938
Projected CRS: WGS 84 / Pseudo-Mercator</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>trees<span class="ot">=</span><span class="fu">st_transform</span>(trees,<span class="dv">2272</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert sf points to spatstat ppp object</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>coords_trees <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(trees)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>pp_trees <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coords_trees[,<span class="dv">1</span>], <span class="at">y =</span> coords_trees[,<span class="dv">2</span>], <span class="at">window =</span> win)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 355 points were rejected as lying outside the specified window</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Run Kernel Density Estimation ====</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sigma = bandwidth in map units (here, meters)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>density_map_trees <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(pp_trees, <span class="at">edge =</span> <span class="cn">TRUE</span>, <span class="at">at =</span> <span class="st">"pixels"</span>,<span class="at">eps =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Convert to raster ====</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>r_trees <span class="ot">&lt;-</span> <span class="fu">rast</span>(density_map_trees)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(r_trees) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(philly_boundary)<span class="sc">$</span>proj4string</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>r_trees <span class="ot">&lt;-</span> <span class="fu">mask</span>(r_trees, <span class="fu">vect</span>(philly_boundary))  <span class="co"># mask to county boundary</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="joining-data-together" class="level3">
<h3 class="anchored" data-anchor-id="joining-data-together">Joining data together</h3>
<p>First, since commercial and office POI and trees are point data, and the more they cluster the higher the housing price will be. As a result, we use Kernel Density method to estimate the density of them. Value of the cell was assign to the point (housing prices), if the point falls within it.</p>
<p>Second, as census tracts and neighborhood are polygon data, a st_within spatial join was used to join them with housing data. Values from polygon data will assign to the points when points fall within it.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Geometry - Cenus Data Merge</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>philly_tract_sf<span class="sc">$</span>GEOID<span class="ot">=</span><span class="fu">as.numeric</span>(philly_tract_sf<span class="sc">$</span>GEOID)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>philly_tract_map <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(philly_censustract, <span class="at">by =</span> <span class="st">"GEOID"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#convert housing prices data into point data</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>phl_sales_clean_sf <span class="ot">=</span> phl_sales_clean<span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_as_sfc</span>(shape)) <span class="sc">%&gt;%</span>   <span class="co"># parse WKT into geometry</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">2272</span>)  </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#convert and match the crs</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>philly_schools_sf_clean<span class="ot">=</span>philly_schools_sf_clean<span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>philly_neighborhoods<span class="ot">=</span>philly_neighborhoods<span class="sc">%&gt;%</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>philly_tract_map<span class="ot">=</span>philly_tract_map<span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#merge them together</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>phl_sales_clean_sf_final<span class="ot">=</span>phl_sales_clean_sf<span class="sc">%&gt;%</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_tract_map,<span class="at">join=</span>st_within)<span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_neighborhoods,<span class="at">join =</span> st_within)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>phl_sales_clean_sf_final <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(phl_sales_clean_sf_final, <span class="at">crs =</span> <span class="fu">st_crs</span>(r_trees))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>phl_sales_clean_sf_final<span class="sc">$</span>EconKDE <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(r_Economic,phl_sales_clean_sf_final)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>phl_sales_clean_sf_final<span class="sc">$</span>TreeKDE <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(r_trees, phl_sales_clean_sf_final)  </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>phl_sales_clean_sf_final<span class="ot">=</span>phl_sales_clean_sf_final<span class="sc">%&gt;%</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="summary-table-before-and-after-dimensions" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-before-and-after-dimensions">Summary table before and after dimensions</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>before_after_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Stage =</span> <span class="fu">c</span>(<span class="st">"Raw Data"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"After Residential Filter (2023–24)"</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"After Removing Errors &amp; NAs"</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"After Spatial Joins &amp; Final Cleaning"</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Rows =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(phl_sales),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">nrow</span>(phl_sales_res_23_24),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">nrow</span>(phl_sales_clean),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">nrow</span>(phl_sales_clean_sf_final)),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Columns =</span> <span class="fu">c</span>(<span class="fu">ncol</span>(phl_sales),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ncol</span>(phl_sales_res_23_24),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ncol</span>(phl_sales_clean),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ncol</span>(phl_sales_clean_sf_final))</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(before_after_summary, <span class="at">caption =</span> <span class="st">"Table A1. Data dimensions before and after cleaning"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table A1. Data dimensions before and after cleaning</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Stage</th>
<th style="text-align: right;">Rows</th>
<th style="text-align: right;">Columns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Raw Data</td>
<td style="text-align: right;">583776</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="even">
<td style="text-align: left;">After Residential Filter (2023–24)</td>
<td style="text-align: right;">34567</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">After Removing Errors &amp; NAs</td>
<td style="text-align: right;">22034</td>
<td style="text-align: right;">81</td>
</tr>
<tr class="even">
<td style="text-align: left;">After Spatial Joins &amp; Final Cleaning</td>
<td style="text-align: right;">22034</td>
<td style="text-align: right;">106</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="phase-2-exploratory-data-analysis" class="level1">
<h1>PHASE 2: EXPLORATORY DATA ANALYSIS</h1>
<section id="distribution-of-sale-prices-histogram" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-sale-prices-histogram">Distribution of sale prices (histogram)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the median / mean to plot</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>price_median <span class="ot">&lt;-</span> <span class="fu">median</span>(phl_sales_clean<span class="sc">$</span>sale_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(sale_price)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">60</span>, <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> price_median, <span class="at">linetype =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> price_median, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">6300</span>, </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Median"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices"</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Sale Price"</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> The histogram plot above shows the full distribution of home sale prices for residential properties in 2023-2024 from our cleaned dataset. The data is extremely right-skewed, highlighting a majority of prices under $500,000 with a long tail of more expensive homes thereafter. The main issue with the extreme outliers of home prices exceeding $5 million that make the visibility of this plot hard to interpret. Also, there are major gaps at higher sales prices as we see the data become more spread out, further indicating the presence of outliers. Therefore, to remedy this, we will plot a second histogram of the price distribution, excluding the top 5% of sales prices from the original cleaned dataset.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new df, filtering out the top 5% of house prices (outliers)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>price_95_perc <span class="ot">&lt;-</span> <span class="fu">quantile</span>(phl_sales_clean<span class="sc">$</span>sale_price, <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>df_95_exclude <span class="ot">&lt;-</span> <span class="fu">filter</span>(phl_sales_clean, sale_price <span class="sc">&lt;=</span> price_95_perc)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the median / mean to plot from trimmed distribution</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>price_median_95_exc <span class="ot">&lt;-</span> <span class="fu">median</span>(df_95_exclude<span class="sc">$</span>sale_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>price_mean_95_exc <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_95_exclude<span class="sc">$</span>sale_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_95_exclude, <span class="fu">aes</span>(sale_price)) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> price_mean_95_exc, <span class="at">linetype =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> price_median_95_exc, <span class="at">linetype =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> price_mean_95_exc,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">2400</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Mean"</span>, </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="sc">-</span> <span class="fl">0.1</span>, </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> price_median_95_exc, </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">2450</span>, </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Median"</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">1.25</span>, </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices"</span>,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Histogram and median/mean statistics were computed on filtered sample (sale price ≤ 95th percentile) for better visibility."</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sale Price"</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> In this revised histogram, we get a much better sense of how the sales prices are distributed without the presence of extreme outliers. As we saw before, the data is definitely right-skewed since the median ($235,250) is less than the mean ($322,231) even when removing large outliers from the top 5% of the distribution. We can visualize that the standard housing market in Philadelphia from 2023-2024 ranges between $0 and $800,000. The distribution has a single peak around $200,000, indicating that it is unimodal with a typical (or most common) home sale price in the realm of $150,000 to $250,000. This is an indication that it may be best to omit these significant outliers from our dataset when building our model for home sale price prediction. The homes on the higher end of the sale price distribution are determined by a combination of structural features (such total livable area) and spatial features (such as nearby city centers) that drive up the prices of these homes. The goal of this study is to determine what features, both structural and spatial, are significant in predicting home sale prices in Philadelphia and create an accurate model to help policy makers in valuating property tax assessments.</p>
</section>
<section id="geographic-distribution-of-sales-price-by-tract" class="level3">
<h3 class="anchored" data-anchor-id="geographic-distribution-of-sales-price-by-tract">Geographic distribution of sales price by tract</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>price_95_perc <span class="ot">&lt;-</span> <span class="fu">quantile</span>(phl_sales_clean<span class="sc">$</span>sale_price, <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>df_95_exclude <span class="ot">&lt;-</span> phl_sales_clean <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sale_price <span class="sc">&lt;=</span> price_95_perc)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>df_95_exclude_sf <span class="ot">&lt;-</span> df_95_exclude <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_as_sfc</span>(shape)) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">2272</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_tract_map, <span class="at">join =</span> st_within)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>tract_price_summary <span class="ot">&lt;-</span> df_95_exclude_sf <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_price =</span> <span class="fu">median</span>(sale_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>philly_price_map <span class="ot">&lt;-</span> philly_tract_map <span class="sc">%&gt;%</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tract_price_summary, <span class="at">by =</span> <span class="st">"GEOID"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ tmap mode set to "plot".</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>price_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(philly_price_map) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"median_price"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"YlGnBu"</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Median Sale Price (≤ 95th Percentile)"</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Median Home Sale Prices by Census Tract (Filtered to ≤ 95th Percentile)"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">outer.margins =</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(df_95_exclude_sf) <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"gray30"</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.02</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">FALSE</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── tmap v3 code detected ───────────────────────────────────────────────────────
[v3-&gt;v4] `tm_polygons()`: instead of `style = "quantile"`, use fill.scale =
`tm_scale_intervals()`.
ℹ Migrate the argument(s) 'style', 'n', 'palette' (rename to 'values') to
  'tm_scale_intervals(&lt;HERE&gt;)'[v3-&gt;v4] `tm_polygons()`: use 'fill' for the fill color of polygons/symbols
(instead of 'col'), and 'col' for the outlines (instead of 'border.col').[v3-&gt;v4] `tm_polygons()`: migrate the argument(s) related to the legend of the
visual variable `fill` namely 'title' to 'fill.legend = tm_legend(&lt;HERE&gt;)'[v3-&gt;v4] `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`[v3-&gt;v4] `tm_dots()`: use `fill_alpha` instead of `alpha`.[v3-&gt;v4] `tm_dots()`: use `fill.legend = tm_legend_hide()` instead of
`legend.show = FALSE`.[tm_dots()] Argument `legend.show` unknown.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>price_map</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[cols4all] color palettes: use palettes from the R package cols4all. Run
`cols4all::c4a_gui()` to explore them. The old palette name "YlGnBu" is named
"brewer.yl_gn_bu"
Multiple palettes called "yl_gn_bu" found: "brewer.yl_gn_bu", "matplotlib.yl_gn_bu". The first one, "brewer.yl_gn_bu", is returned.

[plot mode] fit legend/component: Some legend items or map compoments do not
fit well, and are therefore rescaled.
ℹ Set the tmap option `component.autoscale = FALSE` to disable rescaling.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong></p>
<p>This visualization shows clear spatial clustering of home prices in Philadelphia when looking at the typical market excluding outliers. Higher median prices are concentrated in Center City, University City, and select neighborhoods in South Philadelphia and Northwest Philadelphia. This supports our need to include additional predictors to account amenity density and economic activity.</p>
</section>
<section id="distribution-of-median-income-by-neighborhood" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-median-income-by-neighborhood">Distribution of median income by neighborhood</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>census_points <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(philly_tract_map)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>points_joined <span class="ot">&lt;-</span> <span class="fu">st_join</span>(census_points, philly_neighborhoods)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>mean_income_by_neighborhood <span class="ot">&lt;-</span> points_joined <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MAPNAME) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_income =</span> <span class="fu">mean</span>(median_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>philly_neighborhood_income <span class="ot">&lt;-</span> philly_neighborhoods <span class="sc">%&gt;%</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_income_by_neighborhood, <span class="at">by =</span> <span class="st">"MAPNAME"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ tmap mode set to "plot".</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>neighborhood_income_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(philly_neighborhood_income) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"mean_income"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Median Household Income"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Median Household Income by Neighborhood"</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">outer.margins =</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>),  <span class="co"># &lt;-- more top padding</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── tmap v3 code detected ───────────────────────────────────────────────────────
[v3-&gt;v4] `tm_polygons()`: instead of `style = "quantile"`, use fill.scale =
`tm_scale_intervals()`.
ℹ Migrate the argument(s) 'style', 'n', 'palette' (rename to 'values') to
  'tm_scale_intervals(&lt;HERE&gt;)'[v3-&gt;v4] `tm_polygons()`: migrate the argument(s) related to the legend of the
visual variable `fill` namely 'title' to 'fill.legend = tm_legend(&lt;HERE&gt;)'[v3-&gt;v4] `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>neighborhood_income_map</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[cols4all] color palettes: use palettes from the R package cols4all. Run
`cols4all::c4a_gui()` to explore them. The old palette name "YlOrRd" is named
"brewer.yl_or_rd"
Multiple palettes called "yl_or_rd" found: "brewer.yl_or_rd", "matplotlib.yl_or_rd". The first one, "brewer.yl_or_rd", is returned.

[plot mode] fit legend/component: Some legend items or map compoments do not
fit well, and are therefore rescaled.
ℹ Set the tmap option `component.autoscale = FALSE` to disable rescaling.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong></p>
<p>In this visualization depicting median incomes of residents by neighborhoods, we observe continued spatial clustering of wealth indicators in areas like Center City, Northwest Philadelphia, and South Philadlephia. This is consistent with the basic aggregation of home sale prices on census tracts. The presence of high income in tandem with high housing cost serves as an indication of their relationship and justifies the use of economic predictors in our model. With this spatial auto-correlation, it is important that the model absorbs spatial variation by utilizing additional spatial features.</p>
</section>
<section id="price-vs.-structural-features" class="level3">
<h3 class="anchored" data-anchor-id="price-vs.-structural-features">Price vs.&nbsp;structural features</h3>
<section id="number-of-bathrooms" class="level4">
<h4 class="anchored" data-anchor-id="number-of-bathrooms">1. Number of Bathrooms</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(number_of_bathrooms), <span class="at">y =</span> sale_price)) <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightcyan2"</span>, <span class="at">outlier.color =</span> <span class="st">"firebrick"</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices by Number of Bathrooms"</span>, </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bathrooms"</span>, </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Sale Price"</span>) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> Since number of bathrooms is a discrete variable, a scatter plot is not suitable to visualize this predictor’s relationship with the target variable of sale price; therefore, we opted to use box plots instead. In this first plot, we see a distinct positive relationship between number of bathrooms and home sale price. Intuitively, this makes sense since homes with more bathrooms should on average sell at higher prices. Another trend is that there are more outliers in homes with less bathrooms (between 1 and 3). These outliers are likely due to external spatial factors such as neighborhoods. Housing prices tend to surge in highly desirable neighborhoods such as Rittenhouse Square, which explains the presence of many outliers plotted above the upper bound of these boxplots. Another trend is that variance of sale prices begins to significantly widen for homes with more than 3 bedrooms. This suggests that larger homes with more bathrooms experience more price dispersion relative to those with less bathrooms. Lastly, it is worth noting that there are very few observations of homes with 8 or 12 bathrooms, indicating that it would be beneficial to remove them from our dataset to better capture the true relationship between price and number of bathrooms.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(number_of_bathrooms), <span class="at">y =</span> <span class="fu">log</span>(sale_price))) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightcyan2"</span>, <span class="at">outlier.color =</span> <span class="st">"firebrick"</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Log(Home Sale Prices) by Number of Bathrooms"</span>, </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bathrooms"</span>, </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Log(Sale Price)"</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> In addition, we also plotted with the y-axis transformed to the log of sales price. We notice that there is still a positive relationship that appears more linear than the first plot. The log transformation helps reduce the effect of extreme outliers by compressing the distribution of house sale prices. This transformation also serves to center the distributions as noted by the presence of both positive and negative outliers. These benefits suggest that log-transforming our target variable for a linear regression is the best suitable method to yield an accurate model.</p>
</section>
<section id="number-of-bedrooms" class="level4">
<h4 class="anchored" data-anchor-id="number-of-bedrooms">2. Number of Bedrooms</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(number_of_bedrooms), <span class="at">y =</span> sale_price)) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightcyan2"</span>, <span class="at">outlier.color =</span> <span class="st">"firebrick"</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices by Number of Bedrooms"</span>, </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bedrooms"</span>, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Sale Price"</span>) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> The above plot to measure the relationship between home sale price and number of bedrooms is positive, indicating that homes with more bedrooms tend to sell at higher prices. However, this relationship looks significantly less strong than the relationship between sale price and number of bathrooms. We observe many outliers across homes with various bedroom sizes, most notably those with 2 - 5 bedrooms. The intuition is that these size households are more likely to be sold on the market with higher variability in sales prices, particularly in the upper tail, demonstrating right-skew. These high outliers represent luxury properties that sell for abnormally high sale prices due to other external variables like neighborhood, size etc. Again, we have a small number of very large homes with 10, 11, and 12 bedrooms that are candidates for removal before building our model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(number_of_bedrooms), <span class="at">y =</span> <span class="fu">log</span>(sale_price))) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightcyan2"</span>, <span class="at">outlier.color =</span> <span class="st">"firebrick"</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Log(Home Sale Prices) by Number of Bedrooms"</span>, </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bedrooms"</span>, </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Log(Sale Price)"</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> As before, we can log-transform the target variable log(sale price) to better visualize the relationship with number of bedrooms. We still see a positive relationship that appears more linear than in our earlier plot. As before, the log-transformation stabilizes the variance to mitigate outliers and centers the data demonstrated by outliers at both the upper and lower tails. The strength of the relationship still appears to be not as obvious as with the number of bathrooms. In other words, number of bathrooms may be a more suitable predictor of sale price from these EDA observations. To avoid the risk of multicollinearity, we will keep this finding in mind when determining what structural features should be included in our final model.</p>
</section>
<section id="total-livable-area" class="level4">
<h4 class="anchored" data-anchor-id="total-livable-area">3. Total Livable Area</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> total_livable_area, sale_price)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices by Total Livable Area"</span>, </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Total Livable Area"</span>, </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Sale Price"</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> The plot represents the relationship between the non-transformed target sale price and predictor total livable area. We can see that the relationship to be positive with evidence of heavy right-skew with the majority of data points clustered in the bottom-left with less than 3000 sq ft of area and $500,000 price. Also, we notice that although the relationship is positive, it does not appear to be linear, a violation of a crucial assumption in linear regression. As before, there is the presence of luxury homes as large outliers that can pull the regression line upward, which would create biased estimates on model coefficients.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(total_livable_area), <span class="fu">log</span>(sale_price))) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.075</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Log(Home Sale Prices) by Total Livable Area"</span>, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Log(Total Livable Area)"</span>, </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Log(Sale Price)"</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> By log-transforming both sale price and total livable area, we visualize a relationship that appears much more linear. As we saw before, there seem to be more variability in homes with smaller areas that are more common in this dataset. The transformation has more of a uniform, symmetric spread of points above and below the regression line. We can interpret this relationship as increasing the percentage of total livable area will lead to some constant increase in the percentage of sale price with this transformation. We should keep at mind that the non-constant variance is alarming for potential heteroskedasticity in our model. Again, through the log-transformation of our target variable, we observe a more linear relationship, strengthening the notion for the need for this transformation in our modeling phase.</p>
</section>
<section id="age-sale-date---year-built" class="level4">
<h4 class="anchored" data-anchor-id="age-sale-date---year-built">4. Age (Sale Date - Year Built)</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> sale_price)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.076</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices by Age"</span>, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age"</span>, </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Sale Price"</span>) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> In the above plot, it does not reveal any significant relationship between sale price and home age. The main issue is that most of the data is clustered at the bottom of the figure at low sale prices regardless of age. There are some noticeable outliers along with increased variability for middle-aged homes around 75 to 125 years old. In general, it seems that there newer homes (lower age) demonstrate somewhat higher price levels on average. However, from this plot alone, it is difficult to verify.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="fu">log</span>(sale_price))) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.075</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">span =</span> <span class="fl">0.75</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Log(Home Sale Prices) by Age"</span>, </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age"</span>, </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Log(Sale Price)"</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> After doing the trick to log-transform sale price, we see an interesting shape that somewhat resembles a crucial theory we learned in lecture. This theory outlines that Age has a U-shaped effect on price. Newer homes are sought after due to recent construction with more modern amenities, whereas very old homes are considered to have historic value or charm. The middle-aged homes are therefore the least desirable homes that likely are not modernized with significant wear and tear without the allure of a historic home. While this theory makes sense, it somewhat breaks down for these middle aged homes as their sale prices experience much more variability, which would make our model more at risk of heteroskedasticity. This is likely due to a majority of samples in our dataset within this range whose sale price cannot be explained by age alone. Therefore, it is wise to proceed with caution with using the age variable in building our predictive model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_age_groups <span class="ot">&lt;-</span> phl_sales_clean <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">"New (&lt;20 years)"</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"Middle (20–80 years)"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"Historic (&gt;80 years)"</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">factor</span>(age_group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"New (&lt;20 years)"</span>, <span class="st">"Middle (20–80 years)"</span>, <span class="st">"Historic (&gt;80 years)"</span>))</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_age_groups, <span class="fu">aes</span>(age_group, <span class="fu">log</span>(sale_price))) <span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightcyan2"</span>, <span class="at">outlier.colour =</span> <span class="st">"firebrick"</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Log(Sale Price) by Age Group"</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Philadelphia Residential Sales in 2023–2024"</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Group"</span>, <span class="at">y =</span> <span class="st">"log(Sale Price)"</span>,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> When we engineer a new age group feature, the U-shaped distribution does not appear to be valid in the case of our dataset. Using the age segmentations defined in class, it now appears as there is an inverse (negative) relationship between log(sale price) and age group, not a U-shape distribution. One hypothesis is that very old buildings in Philadelphia are too worn down or don’t hold enough historic value to counteract its age. Whatever the reason may be, it seems that engineering a feature for age group is preferred over using age directly and to expect increasing age to a home to depreciate its value over time.</p>
</section>
</section>
<section id="price-vs.-spatial-features" class="level3">
<h3 class="anchored" data-anchor-id="price-vs.-spatial-features">Price vs.&nbsp;spatial features</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phl_sales_clean_sf_final, <span class="fu">aes</span>(<span class="at">x =</span> EconKDE<span class="sc">$</span>lyr<span class="fl">.1</span>, <span class="at">y=</span>sale_price)) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Home Sale Prices by Economic KDE Value"</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For Philadelphia Residential Properties in 2023-2024"</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"KDE"</span>, </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Sale Price"</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> The plot represents the relationship between the non-transformed target sale price and predictor KDE for economic activities. We can see that the relationship to be positive with evidence of heavy right-skew with the majority of data points clustered in the bottom-left with less than a KDE value of 0.000075 and $500,000 price. Also, we notice that although the relationship is positive, it does not appear to be linear, a violation of a crucial assumption in linear regression. It seems that the trend increases first till about 0.00008 and then decreases. As before, there is the presence of some homes as large outliers that can pull the regression line upward, which would create biased estimates on model coefficients.</p>
</section>
<section id="one-creative-visualization" class="level3">
<h3 class="anchored" data-anchor-id="one-creative-visualization">One creative visualization</h3>
<p><strong>Interpretation:</strong></p>
</section>
</section>
<section id="phase-3-feature-engineering" class="level1">
<h1>PHASE 3: FEATURE ENGINEERING</h1>
<section id="final-data-cleaning-from-structural-eda" class="level3">
<h3 class="anchored" data-anchor-id="final-data-cleaning-from-structural-eda">Final Data Cleaning from Structural EDA</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 99th percentile of sales prices to remove</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>price_99_perc <span class="ot">&lt;-</span> <span class="fu">quantile</span>(phl_sales_clean<span class="sc">$</span>sale_price, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Relevant columns to keep for modeling</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>rel_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Location / Shape</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"census_tract"</span>, <span class="st">"shape"</span>, <span class="st">"location"</span>, <span class="st">"zip_code"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Target</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sale_price"</span>, <span class="st">"log_price"</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regressors (and potential ones)</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_livable_area"</span>, <span class="st">"log_total_livable_area"</span>,</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"number_of_bedrooms"</span>, <span class="st">"number_of_bathrooms"</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year_built"</span>, <span class="st">"age"</span>, <span class="st">"age_group"</span>,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interior_condition"</span>, <span class="st">"quality_grade"</span> </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>phl_sales_final <span class="ot">&lt;-</span> phl_sales_clean <span class="sc">|&gt;</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove top 1% of sale price (extreme outliers)</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This creates an upper bound of around $2 million rather than $6 million to further reduce outlier effects in modeling</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    sale_price <span class="sc">&lt;</span> price_99_perc,</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove bathrooms &gt; 7</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>    number_of_bathrooms <span class="sc">&lt;</span> <span class="dv">8</span>,</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove bedrooms &gt; 9</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    number_of_bedrooms <span class="sc">&lt;</span> <span class="dv">10</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log of sale price</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_price =</span> <span class="fu">log</span>(sale_price),</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log of total livable area</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_total_livable_area =</span> <span class="fu">log</span>(total_livable_area),</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age group buckets (new, middle_age, historic)</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">"New (&lt;20)"</span>,</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"Middle (20–80)"</span>,</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"Historic (&gt;80)"</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For modeling as dummy variables</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">factor</span>(age_group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"New (&lt;20)"</span>, <span class="st">"Middle (20–80)"</span>, <span class="st">"Historic (&gt;80)"</span>))</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select relevant columns</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(rel_columns))</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a><span class="co">#convert housing prices data into point data</span></span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf <span class="ot">=</span> phl_sales_final<span class="sc">%&gt;%</span></span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_as_sfc</span>(shape)) <span class="sc">%&gt;%</span>   <span class="co"># parse WKT into geometry</span></span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">2272</span>)  </span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a><span class="co">#convert and match the crs</span></span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a>philly_schools_sf_final<span class="ot">=</span>philly_schools_sf_clean<span class="sc">%&gt;%</span></span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a>philly_neighborhoods<span class="ot">=</span>philly_neighborhoods<span class="sc">%&gt;%</span></span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a>philly_tract_map<span class="ot">=</span>philly_tract_map<span class="sc">%&gt;%</span></span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a><span class="co">#merge them together</span></span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final<span class="ot">=</span>phl_sales_final_sf<span class="sc">%&gt;%</span></span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_tract_map,<span class="at">join=</span>st_within)<span class="sc">%&gt;%</span></span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_neighborhoods,<span class="at">join =</span> st_within)</span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(phl_sales_final_sf_final, <span class="at">crs =</span> <span class="fu">st_crs</span>(r_trees))</span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final<span class="sc">$</span>EconKDE <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(r_Economic,phl_sales_final_sf_final)</span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final<span class="sc">$</span>TreeKDE <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(r_trees, phl_sales_final_sf_final)  </span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final<span class="ot">=</span>phl_sales_final_sf_final<span class="sc">%&gt;%</span></span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2272</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="classifying-neighborhood" class="level3">
<h3 class="anchored" data-anchor-id="classifying-neighborhood">Classifying Neighborhood</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#convert census tract into points</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>census_points<span class="ot">=</span><span class="fu">st_centroid</span>(philly_tract_map)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>points_joined <span class="ot">&lt;-</span> <span class="fu">st_join</span>(census_points, philly_neighborhoods)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean MHI for each polygon</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>mean_mhi_by_poly <span class="ot">&lt;-</span> points_joined <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>             </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MAPNAME) <span class="sc">%&gt;%</span>            </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">meanMHI =</span> <span class="fu">mean</span>(median_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the result back to the polygon layer</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final <span class="ot">&lt;-</span> phl_sales_final_sf_final <span class="sc">%&gt;%</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_mhi_by_poly, <span class="at">by =</span> <span class="st">"MAPNAME"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() </span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co"># reclassify the neighborhood data based on quantile (25%)</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final<span class="sc">$</span>MHI_quantile <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  phl_sales_final_sf_final<span class="sc">$</span>meanMHI,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">quantile</span>(</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    phl_sales_final_sf_final<span class="sc">$</span>meanMHI,</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),   </span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Q1 (lowest)"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4 (highest)"</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="calculating-distance-to-schools-using-k-nearest-method" class="level3">
<h3 class="anchored" data-anchor-id="calculating-distance-to-schools-using-k-nearest-method">Calculating distance to schools using K-nearest method</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute distance matrix</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(phl_sales_final_sf_final, philly_schools_sf_final)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the 3 smallest distances for each point</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>nearest_3 <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sort</span>(x)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the average or total distance if needed</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>mean_nearest3 <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">sort</span>(x)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]))</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final<span class="sc">$</span>mean_3nn_dist <span class="ot">&lt;-</span> mean_nearest3</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="summary-table" class="level3">
<h3 class="anchored" data-anchor-id="summary-table">Summary table</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reformat raster data into a "readable" format by stargazer</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>phl_sales_final_sf_final <span class="ot">&lt;-</span> phl_sales_final_sf_final <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EconKDE =</span> EconKDE<span class="sc">$</span>lyr<span class="fl">.1</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">TreeKDE =</span> TreeKDE<span class="sc">$</span>lyr<span class="fl">.1</span>) </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#exclude the unnecessary data</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>summary_data <span class="ot">&lt;-</span> phl_sales_final_sf_final <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    census_tract, shape, NAME.x, NAME.y, MAPNAME,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    Shape_Area, Shape_Leng, location, zip_code, GEOID, </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    variabl, age_group, quality_grade, LISTNAME, MHI_quantile,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    estimat,moe,pct_bch,pct_vcn,pct_wht,mdn_ncm,fmly_hh,totl_hh</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only numeric columns</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>summary_numeric <span class="ot">&lt;-</span> summary_data <span class="sc">%&gt;%</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>summary_numeric_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(summary_numeric)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as HTML locally</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(summary_numeric_df,</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"html"</span>,</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Summary Statistics"</span>,</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary.stat =</span> <span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"median"</span>, <span class="st">"max"</span>),</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels =</span> <span class="fu">c</span>(<span class="st">"Sale Price"</span>, <span class="st">"Log Price"</span>, <span class="st">"Total Livable Area"</span>, </span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Log Total Livable Area"</span>, <span class="st">"Bedrooms"</span>, <span class="st">"Bathrooms"</span>, </span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Year Built"</span>, <span class="st">"Age"</span>, <span class="st">"Interior Condition"</span>, </span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Median Income"</span>,<span class="st">"Family HH"</span>, </span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Total HH"</span>, <span class="st">"% Bachelors"</span>, <span class="st">"% Vacant"</span>, <span class="st">"% White"</span>,</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Econ KDE"</span>, <span class="st">"Tree KDE"</span>, <span class="st">"Mean MHI"</span>, </span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Mean 3 closest School Dist"</span>),</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">out =</span> <span class="st">"summary_statistics.html"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
&lt;table style="text-align:center"&gt;&lt;caption&gt;&lt;strong&gt;Summary Statistics&lt;/strong&gt;&lt;/caption&gt;
&lt;tr&gt;&lt;td colspan="7" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Statistic&lt;/td&gt;&lt;td&gt;N&lt;/td&gt;&lt;td&gt;Mean&lt;/td&gt;&lt;td&gt;St. Dev.&lt;/td&gt;&lt;td&gt;Min&lt;/td&gt;&lt;td&gt;Median&lt;/td&gt;&lt;td&gt;Max&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="7" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Sale Price&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;289,078.80&lt;/td&gt;&lt;td&gt;245,777.60&lt;/td&gt;&lt;td&gt;10,000&lt;/td&gt;&lt;td&gt;235,000&lt;/td&gt;&lt;td&gt;2,285,000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Log Price&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;12.28&lt;/td&gt;&lt;td&gt;0.81&lt;/td&gt;&lt;td&gt;9.21&lt;/td&gt;&lt;td&gt;12.37&lt;/td&gt;&lt;td&gt;14.64&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Total Livable Area&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;1,363.18&lt;/td&gt;&lt;td&gt;534.22&lt;/td&gt;&lt;td&gt;420&lt;/td&gt;&lt;td&gt;1,216&lt;/td&gt;&lt;td&gt;9,038&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Log Total Livable Area&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;7.16&lt;/td&gt;&lt;td&gt;0.31&lt;/td&gt;&lt;td&gt;6.04&lt;/td&gt;&lt;td&gt;7.10&lt;/td&gt;&lt;td&gt;9.11&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Bedrooms&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;3.07&lt;/td&gt;&lt;td&gt;0.71&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;td&gt;9&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Bathrooms&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;1.43&lt;/td&gt;&lt;td&gt;0.67&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Year Built&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;1,937.29&lt;/td&gt;&lt;td&gt;29.78&lt;/td&gt;&lt;td&gt;1,750&lt;/td&gt;&lt;td&gt;1,925&lt;/td&gt;&lt;td&gt;2,025&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Age&lt;/td&gt;&lt;td&gt;21,807&lt;/td&gt;&lt;td&gt;86.21&lt;/td&gt;&lt;td&gt;29.78&lt;/td&gt;&lt;td&gt;-2&lt;/td&gt;&lt;td&gt;98&lt;/td&gt;&lt;td&gt;274&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Interior Condition&lt;/td&gt;&lt;td&gt;21,806&lt;/td&gt;&lt;td&gt;3.40&lt;/td&gt;&lt;td&gt;0.93&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Median Income&lt;/td&gt;&lt;td&gt;21,546&lt;/td&gt;&lt;td&gt;66,489.29&lt;/td&gt;&lt;td&gt;30,604.07&lt;/td&gt;&lt;td&gt;13,721&lt;/td&gt;&lt;td&gt;60,957&lt;/td&gt;&lt;td&gt;192,727&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Family HH&lt;/td&gt;&lt;td&gt;21,805&lt;/td&gt;&lt;td&gt;1,095.76&lt;/td&gt;&lt;td&gt;434.94&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;1,054&lt;/td&gt;&lt;td&gt;2,484&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Total HH&lt;/td&gt;&lt;td&gt;21,805&lt;/td&gt;&lt;td&gt;1,945.64&lt;/td&gt;&lt;td&gt;602.97&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;1,911&lt;/td&gt;&lt;td&gt;3,713&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;% Bachelors&lt;/td&gt;&lt;td&gt;21,802&lt;/td&gt;&lt;td&gt;32.42&lt;/td&gt;&lt;td&gt;22.73&lt;/td&gt;&lt;td&gt;1.50&lt;/td&gt;&lt;td&gt;26.33&lt;/td&gt;&lt;td&gt;94.84&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;% Vacant&lt;/td&gt;&lt;td&gt;21,800&lt;/td&gt;&lt;td&gt;9.33&lt;/td&gt;&lt;td&gt;5.93&lt;/td&gt;&lt;td&gt;0.00&lt;/td&gt;&lt;td&gt;8.23&lt;/td&gt;&lt;td&gt;32.88&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;% White&lt;/td&gt;&lt;td&gt;21,802&lt;/td&gt;&lt;td&gt;38.14&lt;/td&gt;&lt;td&gt;29.94&lt;/td&gt;&lt;td&gt;0.00&lt;/td&gt;&lt;td&gt;35.22&lt;/td&gt;&lt;td&gt;95.51&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Econ KDE&lt;/td&gt;&lt;td&gt;21,804&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.00&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Tree KDE&lt;/td&gt;&lt;td&gt;21,804&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.0000&lt;/td&gt;&lt;td&gt;0.0001&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Mean MHI&lt;/td&gt;&lt;td&gt;21,459&lt;/td&gt;&lt;td&gt;66,651.63&lt;/td&gt;&lt;td&gt;27,950.13&lt;/td&gt;&lt;td&gt;18,646.00&lt;/td&gt;&lt;td&gt;59,779.14&lt;/td&gt;&lt;td&gt;168,021.00&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Mean 3 closest School Dist&lt;/td&gt;&lt;td&gt;21,805&lt;/td&gt;&lt;td&gt;2,598.76&lt;/td&gt;&lt;td&gt;1,190.85&lt;/td&gt;&lt;td&gt;336.99&lt;/td&gt;&lt;td&gt;2,363.89&lt;/td&gt;&lt;td&gt;11,109.39&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="7" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print as txt in R</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(summary_numeric_df,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"text"</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Summary Statistics"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary.stat =</span> <span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"median"</span>, <span class="st">"max"</span>),</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels =</span> <span class="fu">c</span>(<span class="st">"Sale Price"</span>, <span class="st">"Log Price"</span>, <span class="st">"Total Livable Area"</span>, </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Log Total Livable Area"</span>, <span class="st">"Bedrooms"</span>, <span class="st">"Bathrooms"</span>, </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Year Built"</span>, <span class="st">"Age"</span>, <span class="st">"Interior Condition"</span>, </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Median Income"</span>,<span class="st">"Family HH"</span>, </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Total HH"</span>, <span class="st">"% Bachelors"</span>, <span class="st">"% Vacant"</span>, <span class="st">"% White"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Econ KDE"</span>, <span class="st">"Tree KDE"</span>, <span class="st">"Mean MHI"</span>, </span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Mean 3 closest School Dist"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Summary Statistics
======================================================================================
Statistic                    N       Mean     St. Dev.     Min     Median      Max    
--------------------------------------------------------------------------------------
Sale Price                 21,807 289,078.80 245,777.60  10,000    235,000  2,285,000 
Log Price                  21,807   12.28       0.81      9.21      12.37     14.64   
Total Livable Area         21,807  1,363.18    534.22      420      1,216     9,038   
Log Total Livable Area     21,807    7.16       0.31      6.04      7.10       9.11   
Bedrooms                   21,807    3.07       0.71        0         3         9     
Bathrooms                  21,807    1.43       0.67        1         1         7     
Year Built                 21,807  1,937.29    29.78      1,750     1,925     2,025   
Age                        21,807   86.21      29.78       -2        98        274    
Interior Condition         21,806    3.40       0.93        1         4         7     
Median Income              21,546 66,489.29  30,604.07   13,721    60,957    192,727  
Family HH                  21,805  1,095.76    434.94       0       1,054     2,484   
Total HH                   21,805  1,945.64    602.97       0       1,911     3,713   
% Bachelors                21,802   32.42      22.73      1.50      26.33     94.84   
% Vacant                   21,800    9.33       5.93      0.00      8.23      32.88   
% White                    21,802   38.14      29.94      0.00      35.22     95.51   
Econ KDE                   21,804   0.0000     0.0000     0.00     0.0000     0.0000  
Tree KDE                   21,804   0.0000     0.0000    0.0000    0.0000     0.0001  
Mean MHI                   21,459 66,651.63  27,950.13  18,646.00 59,779.14 168,021.00
Mean 3 closest School Dist 21,805  2,598.76   1,190.85   336.99   2,363.89  11,109.39 
--------------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="final-cleaning-before-building-the-model" class="level3">
<h3 class="anchored" data-anchor-id="final-cleaning-before-building-the-model">Final Cleaning Before Building the Model</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>for_model_building <span class="ot">&lt;-</span> phl_sales_final_sf_final <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    census_tract, shape, NAME.x, NAME.y,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    Shape_Area, Shape_Leng, location, zip_code, GEOID, </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    variabl, LISTNAME, </span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    estimat,moe,pct_bch,pct_vcn,pct_wht,mdn_ncm,fmly_hh,totl_hh</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="justification-of-feature-engineered-variables" class="level3">
<h3 class="anchored" data-anchor-id="justification-of-feature-engineered-variables">Justification of feature engineered variables</h3>
<p>We have used a number of methods to create spatial features in both Phase 1 and 3. First, in Phase 1, since commercial and office POI and trees are point data, and the more they cluster the higher the housing price will be. As a result, we use Kernel Density method to estimate the density of them. Value of the cell was assign to the point (housing prices), if the point falls within it.</p>
<p>Second, as census tracts and neighborhood are polygon data, a st_within spatial join was used to join them with housing data. Values from polygon data will assign to the points when points fall within it.</p>
<p>Third, as there are too many neighborhoods, it is hard to interpret the coefficient of them as it is a categorical variable. We reclassify it with four different categories based on quantile of MHI(25%). To calculate the MHI each neighborhood, we first take the centroid of each census tract and summarize them within each neighborhood. Then we take the mean of MHI of the tracts that fall within the neighborhood.</p>
<p>Lastly, different from poi and trees, a high cluster of schools may not reflect a high housing price. As a result, instead of using density estimation, we use 3-nearest distance and take the mean to capture some of the closest schools.</p>
<p>#Phase 4: Model Building</p>
<p>####create train/test data first (make workflow smoother)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(for_model_building)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 70% training, 30% testing</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> <span class="fl">0.7</span> <span class="sc">*</span> n)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> for_model_building[train_indices, ]</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> for_model_building[<span class="sc">-</span>train_indices, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>###Building the model progressively ####Model 1: Individual characteristic only</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run regression based on houses own characteristic</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">=</span><span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>interior_condition<span class="sc">+</span>quality_grade,<span class="at">data=</span>for_model_building)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_price ~ log_total_livable_area + number_of_bedrooms + 
    number_of_bathrooms + age + interior_condition + quality_grade, 
    data = for_model_building)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.9177 -0.3081  0.0803  0.3908  3.4233 

Coefficients:
                         Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)             6.2999874  0.2126295  29.629 &lt; 0.0000000000000002 ***
log_total_livable_area  0.9805519  0.0228959  42.826 &lt; 0.0000000000000002 ***
number_of_bedrooms     -0.1538913  0.0081175 -18.958 &lt; 0.0000000000000002 ***
number_of_bathrooms     0.2655967  0.0088561  29.990 &lt; 0.0000000000000002 ***
age                    -0.0020033  0.0001711 -11.709 &lt; 0.0000000000000002 ***
interior_condition     -0.1940613  0.0054605 -35.539 &lt; 0.0000000000000002 ***
quality_grade5         -0.7390910  0.4705778  -1.571              0.11629    
quality_gradeA          0.0251645  0.1751658   0.144              0.88577    
quality_gradeA-         0.0295263  0.1814730   0.163              0.87075    
quality_gradeA+         0.0611624  0.2121474   0.288              0.77312    
quality_gradeB          0.0320486  0.1524305   0.210              0.83347    
quality_gradeB-         0.1265652  0.1516088   0.835              0.40383    
quality_gradeB+        -0.0474156  0.1571845  -0.302              0.76292    
quality_gradeC         -0.1452483  0.1498012  -0.970              0.33225    
quality_gradeC-        -0.1027752  0.1517525  -0.677              0.49825    
quality_gradeC+        -0.0267014  0.1500292  -0.178              0.85874    
quality_gradeD          0.1473498  0.1572472   0.937              0.34874    
quality_gradeD-        -0.2209235  0.3197212  -0.691              0.48958    
quality_gradeD+         0.2265099  0.1814849   1.248              0.21201    
quality_gradeE         -0.4206165  0.2143947  -1.962              0.04979 *  
quality_gradeE-        -0.6936639  0.2495913  -2.779              0.00545 ** 
quality_gradeE+        -0.3686049  0.2496201  -1.477              0.13978    
quality_gradeS          0.0710844  0.4709353   0.151              0.88002    
quality_gradeX-         0.3722878  0.4722638   0.788              0.43053    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6313 on 21245 degrees of freedom
  (因为不存在，538个观察量被删除了)
Multiple R-squared:  0.3771,    Adjusted R-squared:  0.3764 
F-statistic: 559.2 on 23 and 21245 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check colinearity</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           GVIF Df GVIF^(1/(2*Df))
log_total_livable_area 2.559182  1        1.599744
number_of_bedrooms     1.754091  1        1.324421
number_of_bathrooms    1.745491  1        1.321170
age                    1.137622  1        1.066594
interior_condition     1.196302  1        1.093756
quality_grade          1.631892 18        1.013697</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#vif looks fine, check heteroskedasticity</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model1
BP = 881.72, df = 23, p-value &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#p-value is way too small, implying more variables may be needed (make sense)</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the RMSE</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>model_train_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age<span class="sc">+</span>interior_condition<span class="sc">+</span>quality_grade,<span class="at">data =</span> train_data)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>test_predictions_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_1, <span class="at">newdata =</span> test_data)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>rmse_test_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>log_price <span class="sc">-</span> test_predictions_1)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>rmse_train_1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_train_1)<span class="sc">$</span>sigma</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-41-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-41-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-41-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In residual plot, more observations are clustered when fitted value is lower, indicating bad distribution of residuals and nonlinearity.</p>
<p>Same issue is reflected in Q-Q plot as well, the unlinearity revels the distribution of residual is not normal.</p>
<p>There is also heteroskedasticity, as the scale location shows, the line is not linear at all.</p>
<p>The outliers seems to have small influence on the leverage,as the line is almost linear shown in the last graph</p>
<p>####Model 2: add census variables into regression</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>quality_grade ,<span class="at">data=</span>for_model_building)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_price ~ log_total_livable_area + number_of_bedrooms + 
    number_of_bathrooms + age + interior_condition + median_income + 
    I(family_hh/total_hh) + pct_bachelors + pct_vacant + pct_white + 
    quality_grade, data = for_model_building)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.0624 -0.1965  0.0620  0.2672  3.4712 

Coefficients:
                            Estimate    Std. Error t value             Pr(&gt;|t|)
(Intercept)             8.1058037963  0.1728369352  46.899 &lt; 0.0000000000000002
log_total_livable_area  0.5538846916  0.0187767976  29.498 &lt; 0.0000000000000002
number_of_bedrooms      0.0023439696  0.0066684851   0.351              0.72522
number_of_bathrooms     0.1663096478  0.0071583003  23.233 &lt; 0.0000000000000002
age                    -0.0015366030  0.0001464531 -10.492 &lt; 0.0000000000000002
interior_condition     -0.1714564249  0.0044711059 -38.348 &lt; 0.0000000000000002
median_income           0.0000006343  0.0000002553   2.484              0.01299
I(family_hh/total_hh)   0.1443236566  0.0352559283   4.094            0.0000426
pct_bachelors           0.0098889478  0.0003722161  26.568 &lt; 0.0000000000000002
pct_vacant             -0.0166358372  0.0006790400 -24.499 &lt; 0.0000000000000002
pct_white               0.0060401571  0.0001902132  31.755 &lt; 0.0000000000000002
quality_grade5         -0.4344933604  0.3739074939  -1.162              0.24523
quality_gradeA          0.1107178862  0.1393149268   0.795              0.42678
quality_gradeA-         0.0700769181  0.1443339817   0.486              0.62731
quality_gradeA+         0.1136545224  0.1687270806   0.674              0.50057
quality_gradeB          0.0975160749  0.1212863598   0.804              0.42140
quality_gradeB-         0.1799630519  0.1206855192   1.491              0.13593
quality_gradeB+         0.0245424614  0.1250391566   0.196              0.84439
quality_gradeC          0.1650394170  0.1193943723   1.382              0.16689
quality_gradeC-         0.1301253997  0.1209034284   1.076              0.28182
quality_gradeC+         0.1870692517  0.1195349845   1.565              0.11760
quality_gradeD          0.1868565185  0.1253851839   1.490              0.13617
quality_gradeD-        -0.0812834412  0.2541690364  -0.320              0.74912
quality_gradeD+         0.3987094613  0.1444507895   2.760              0.00578
quality_gradeE         -0.0531677446  0.1704506786  -0.312              0.75510
quality_gradeE-         0.1439129539  0.2137544484   0.673              0.50079
quality_gradeE+        -0.0010031690  0.1985273954  -0.005              0.99597
quality_gradeS          0.3750806992  0.3742472792   1.002              0.31625
quality_gradeX-         0.0436059017  0.3755434914   0.116              0.90756
                          
(Intercept)            ***
log_total_livable_area ***
number_of_bedrooms        
number_of_bathrooms    ***
age                    ***
interior_condition     ***
median_income          *  
I(family_hh/total_hh)  ***
pct_bachelors          ***
pct_vacant             ***
pct_white              ***
quality_grade5            
quality_gradeA            
quality_gradeA-           
quality_gradeA+           
quality_gradeB            
quality_gradeB-           
quality_gradeB+           
quality_gradeC            
quality_gradeC-           
quality_gradeC+           
quality_gradeD            
quality_gradeD-           
quality_gradeD+        ** 
quality_gradeE            
quality_gradeE-           
quality_gradeE+           
quality_gradeS            
quality_gradeX-           
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5016 on 20981 degrees of freedom
  (因为不存在，797个观察量被删除了)
Multiple R-squared:  0.604, Adjusted R-squared:  0.6035 
F-statistic:  1143 on 28 and 20981 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#number of bedroom becomes statistical insignificant after controling census variable</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">#check colinearity</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           GVIF Df GVIF^(1/(2*Df))
log_total_livable_area 2.698470  1        1.642702
number_of_bedrooms     1.852123  1        1.360927
number_of_bathrooms    1.789763  1        1.337820
age                    1.315849  1        1.147105
interior_condition     1.251877  1        1.118873
median_income          5.077347  1        2.253297
I(family_hh/total_hh)  1.903464  1        1.379661
pct_bachelors          5.954738  1        2.440233
pct_vacant             1.356028  1        1.164486
pct_white              2.696400  1        1.642072
quality_grade          1.776112 18        1.016084</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#edu_attainment and mhi may have muticolinearity</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model2
BP = 1068.9, df = 28, p-value &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#p-value is way too small, implying more variables may be needed (make sense)</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the RMSE</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>model_train_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age<span class="sc">+</span>interior_condition<span class="sc">+</span>median_income</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span>quality_grade,<span class="at">data =</span> train_data)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>test_predictions_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_2, <span class="at">newdata =</span> test_data)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>rmse_test_2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>log_price <span class="sc">-</span> test_predictions_2)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>rmse_train_2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_train_2)<span class="sc">$</span>sigma</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-42-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-42-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The residual plot for model 2 looks much better than that in model 1. The number of observations are clustered when fitted value is lower decreases, indicating better distribution of residuals. The non-linearity issue also gets better</p>
<p>Q-Q plot still does not look good, especially for the outliers. It seems that outliers is influencing the normality of residuals</p>
<p>There is also heteroskedasticity, as the scale location shows, the line is not linear at all.</p>
<p>The outlier seems to have small influence on the leverage,as the line is almost linear shown in the last graph</p>
<p>####Model 3: add spatial variables into regression</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">=</span><span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>TreeKDE</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>mean_3nn_dist<span class="sc">+</span>quality_grade,<span class="at">data=</span>for_model_building)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_price ~ log_total_livable_area + number_of_bedrooms + 
    number_of_bathrooms + age + interior_condition + median_income + 
    I(family_hh/total_hh) + pct_bachelors + pct_vacant + pct_white + 
    EconKDE + I(EconKDE^2) + TreeKDE + mean_3nn_dist + quality_grade, 
    data = for_model_building)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.0763 -0.1967  0.0608  0.2656  3.4935 

Coefficients:
                                   Estimate           Std. Error t value
(Intercept)                    8.3783299532         0.1740881213  48.127
log_total_livable_area         0.5346093571         0.0187760802  28.473
number_of_bedrooms             0.0011989834         0.0066624020   0.180
number_of_bathrooms            0.1637190315         0.0071411581  22.926
age                           -0.0014209099         0.0001532852  -9.270
interior_condition            -0.1775947631         0.0045024707 -39.444
median_income                  0.0000009704         0.0000002578   3.764
I(family_hh/total_hh)          0.0331453924         0.0370507956   0.895
pct_bachelors                  0.0115939901         0.0004236876  27.364
pct_vacant                    -0.0132797438         0.0007638695 -17.385
pct_white                      0.0050023781         0.0002087814  23.960
EconKDE                   -15860.6841109123      2421.6438376466  -6.550
I(EconKDE^2)           688762600.4846765995  85099552.5541760921   8.094
TreeKDE                    -2341.5837838513       380.4441607759  -6.155
mean_3nn_dist                  0.0000022820         0.0000037513   0.608
quality_grade5                -0.4575975628         0.3725192300  -1.228
quality_gradeA                 0.1078678888         0.1387476044   0.777
quality_gradeA-                0.0920255443         0.1437689440   0.640
quality_gradeA+                0.1149432705         0.1680622891   0.684
quality_gradeB                 0.1124835660         0.1208036189   0.931
quality_gradeB-                0.1950381512         0.1202029379   1.623
quality_gradeB+                0.0515740734         0.1245540491   0.414
quality_gradeC                 0.1774362098         0.1189221051   1.492
quality_gradeC-                0.1384615299         0.1204398684   1.150
quality_gradeC+                0.1987228541         0.1190544047   1.669
quality_gradeD                 0.2119521212         0.1249195598   1.697
quality_gradeD-               -0.0652079614         0.2531473729  -0.258
quality_gradeD+                0.4061542964         0.1438730055   2.823
quality_gradeE                -0.0115059364         0.1698254695  -0.068
quality_gradeE-                0.1816007844         0.2129403013   0.853
quality_gradeE+                0.0303578692         0.1977577410   0.154
quality_gradeS                 0.4097776542         0.3727778195   1.099
quality_gradeX-               -0.0047947570         0.3742122086  -0.013
                                   Pr(&gt;|t|)    
(Intercept)            &lt; 0.0000000000000002 ***
log_total_livable_area &lt; 0.0000000000000002 ***
number_of_bedrooms                 0.857184    
number_of_bathrooms    &lt; 0.0000000000000002 ***
age                    &lt; 0.0000000000000002 ***
interior_condition     &lt; 0.0000000000000002 ***
median_income                      0.000168 ***
I(family_hh/total_hh)              0.371015    
pct_bachelors          &lt; 0.0000000000000002 ***
pct_vacant             &lt; 0.0000000000000002 ***
pct_white              &lt; 0.0000000000000002 ***
EconKDE                 0.00000000005904720 ***
I(EconKDE^2)            0.00000000000000061 ***
TreeKDE                 0.00000000076502707 ***
mean_3nn_dist                      0.542976    
quality_grade5                     0.219316    
quality_gradeA                     0.436908    
quality_gradeA-                    0.522119    
quality_gradeA+                    0.494025    
quality_gradeB                     0.351798    
quality_gradeB-                    0.104696    
quality_gradeB+                    0.678827    
quality_gradeC                     0.135704    
quality_gradeC-                    0.250309    
quality_gradeC+                    0.095097 .  
quality_gradeD                     0.089767 .  
quality_gradeD-                    0.796727    
quality_gradeD+                    0.004762 ** 
quality_gradeE                     0.945984    
quality_gradeE-                    0.393766    
quality_gradeE+                    0.877997    
quality_gradeS                     0.271670    
quality_gradeX-                    0.989777    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4995 on 20976 degrees of freedom
  (因为不存在，798个观察量被删除了)
Multiple R-squared:  0.6074,    Adjusted R-squared:  0.6068 
F-statistic:  1014 on 32 and 20976 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#percent of family hh become not significant, number of bedrooms become significant again</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co">#check colinearity</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            GVIF Df GVIF^(1/(2*Df))
log_total_livable_area  2.720483  1        1.649389
number_of_bedrooms      1.863972  1        1.365273
number_of_bathrooms     1.795800  1        1.340074
age                     1.453332  1        1.205542
interior_condition      1.279934  1        1.131342
median_income           5.218998  1        2.284513
I(family_hh/total_hh)   2.119492  1        1.455847
pct_bachelors           7.779040  1        2.789093
pct_vacant              1.730021  1        1.315303
pct_white               3.275071  1        1.809716
EconKDE                10.028263  1        3.166743
I(EconKDE^2)            7.116771  1        2.667728
TreeKDE                 4.100250  1        2.024907
mean_3nn_dist           1.673421  1        1.293608
quality_grade           1.817878 18        1.016741</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#very sure edu_attainment and mhi may have muticolinearity, make sense EconKDE and its squared term have high vif score as we are taking quadratic term</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model3
BP = 1136.8, df = 32, p-value &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#p-value is way too small, implying more variables may be needed </span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the RMSE</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>model_train_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>TreeKDE</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>mean_3nn_dist<span class="sc">+</span>quality_grade,<span class="at">data =</span> train_data)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>test_predictions_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_3, <span class="at">newdata =</span> test_data)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>rmse_test_3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>log_price <span class="sc">-</span> test_predictions_3)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>rmse_train_3 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_train_3)<span class="sc">$</span>sigma</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-43-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-43-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The residual plot for model 3 does not change that much compared to model 2. The majority of the issues remain…..</p>
<p>####Model 4: add fixed variable and interaction terms into regression</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>TreeKDE</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>mean_3nn_dist<span class="sc">+</span>MHI_quantile<span class="sc">*</span>age,<span class="at">data=</span>for_model_building)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_price ~ log_total_livable_area + number_of_bedrooms + 
    number_of_bathrooms + age + interior_condition + median_income + 
    I(family_hh/total_hh) + pct_bachelors + pct_vacant + pct_white + 
    EconKDE + I(EconKDE^2) + TreeKDE + mean_3nn_dist + MHI_quantile * 
    age, data = for_model_building)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.0161 -0.1883  0.0557  0.2501  3.5595 

Coefficients:
                                         Estimate           Std. Error t value
(Intercept)                          8.6125643428         0.1216159461  70.818
log_total_livable_area               0.5259124938         0.0169476595  31.032
number_of_bedrooms                   0.0047629608         0.0064527918   0.738
number_of_bathrooms                  0.1641674908         0.0067744636  24.233
age                                 -0.0042623902         0.0004263922  -9.996
interior_condition                  -0.1589445783         0.0042365850 -37.517
median_income                       -0.0000001065         0.0000002627  -0.405
I(family_hh/total_hh)                0.0772305051         0.0360302644   2.143
pct_bachelors                        0.0086856549         0.0004222698  20.569
pct_vacant                          -0.0110405035         0.0007461681 -14.796
pct_white                            0.0046941087         0.0002196660  21.369
EconKDE                           1835.6937320806      2401.2669301564   0.764
I(EconKDE^2)                 149940588.0799231231  82710328.6550365835   1.813
TreeKDE                          -1444.8536167464       375.7923770221  -3.845
mean_3nn_dist                        0.0000161774         0.0000037108   4.360
MHI_quantileQ2                       0.1616120089         0.0513033653   3.150
MHI_quantileQ3                      -0.0255255524         0.0472251379  -0.541
MHI_quantileQ4 (highest)            -0.0976844912         0.0454156017  -2.151
age:MHI_quantileQ2                   0.0011668614         0.0005459783   2.137
age:MHI_quantileQ3                   0.0027411779         0.0004937926   5.551
age:MHI_quantileQ4 (highest)         0.0045408378         0.0004522698  10.040
                                         Pr(&gt;|t|)    
(Intercept)                  &lt; 0.0000000000000002 ***
log_total_livable_area       &lt; 0.0000000000000002 ***
number_of_bedrooms                       0.460447    
number_of_bathrooms          &lt; 0.0000000000000002 ***
age                          &lt; 0.0000000000000002 ***
interior_condition           &lt; 0.0000000000000002 ***
median_income                            0.685317    
I(family_hh/total_hh)                    0.032085 *  
pct_bachelors                &lt; 0.0000000000000002 ***
pct_vacant                   &lt; 0.0000000000000002 ***
pct_white                    &lt; 0.0000000000000002 ***
EconKDE                                  0.444596    
I(EconKDE^2)                             0.069871 .  
TreeKDE                                  0.000121 ***
mean_3nn_dist                        0.0000130912 ***
MHI_quantileQ2                           0.001634 ** 
MHI_quantileQ3                           0.588853    
MHI_quantileQ4 (highest)                 0.031495 *  
age:MHI_quantileQ2                       0.032594 *  
age:MHI_quantileQ3                   0.0000000287 ***
age:MHI_quantileQ4 (highest) &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4866 on 21175 degrees of freedom
  (因为不存在，611个观察量被删除了)
Multiple R-squared:  0.6351,    Adjusted R-squared:  0.6347 
F-statistic:  1843 on 20 and 21175 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#percent of family hh become not significant, number of bedrooms become significant again</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">#check colinearity</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                              GVIF Df GVIF^(1/(2*Df))
log_total_livable_area    2.511143  1        1.584659
number_of_bedrooms        1.864867  1        1.365601
number_of_bathrooms       1.866932  1        1.366357
age                      14.576046  1        3.817859
interior_condition        1.401352  1        1.183787
median_income             5.826827  1        2.413882
I(family_hh/total_hh)     2.143307  1        1.464004
pct_bachelors             8.315435  1        2.883650
pct_vacant                1.753757  1        1.324295
pct_white                 3.872115  1        1.967769
EconKDE                  10.646189  1        3.262850
I(EconKDE^2)              7.366401  1        2.714111
TreeKDE                   4.295456  1        2.072548
mean_3nn_dist             1.766341  1        1.329038
MHI_quantile           4463.462105  3        4.057688
age:MHI_quantile       4544.316974  3        4.069847</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">#very sure edu_attainment and mhi may have muticolinearity</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co">#tree seems to be correlated with neighborhood (make sense)</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co">#make sense EconKDE and its squared term have high vif score as we are taking quadratic term</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model4
BP = 1196.6, df = 20, p-value &lt; 0.00000000000000022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#p-value is way too small, implying more variables may be needed </span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the RMSE</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>model_train_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>TreeKDE</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>          <span class="sc">+</span>mean_3nn_dist<span class="sc">+</span>MHI_quantile<span class="sc">*</span>age,<span class="at">data =</span> train_data)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>test_predictions_4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_4, <span class="at">newdata =</span> test_data)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>rmse_test_4 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>log_price <span class="sc">-</span> test_predictions_4)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>rmse_train_4 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_train_4)<span class="sc">$</span>sigma</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-44-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-44-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>#one comparison table (RMSE, R² for 4 different models you constructed in your process)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>rmse_values <span class="ot">=</span> <span class="fu">c</span>(rmse_test_1,rmse_test_2,rmse_test_3,rmse_test_4)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>adj_r2 <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model1)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model2)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model3)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(model4)<span class="sc">$</span>adj.r.squared</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Model 1"</span>, <span class="st">"Model 2"</span>, <span class="st">"Model 3"</span>, <span class="st">"Model 4"</span>),</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">round</span>(rmse_values, <span class="dv">3</span>),</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Adj_R2 =</span> <span class="fu">round</span>(adj_r2, <span class="dv">3</span>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model_summary,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"html"</span>,</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Model Performance Summary"</span>,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">out =</span> <span class="st">"model_performance_summary.html"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
&lt;table style="text-align:center"&gt;&lt;caption&gt;&lt;strong&gt;Model Performance Summary&lt;/strong&gt;&lt;/caption&gt;
&lt;tr&gt;&lt;td colspan="3" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Model&lt;/td&gt;&lt;td&gt;RMSE&lt;/td&gt;&lt;td&gt;Adj_R2&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="3" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 1&lt;/td&gt;&lt;td&gt;0.620&lt;/td&gt;&lt;td&gt;0.376&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 2&lt;/td&gt;&lt;td&gt;0.491&lt;/td&gt;&lt;td&gt;0.604&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 3&lt;/td&gt;&lt;td&gt;0.490&lt;/td&gt;&lt;td&gt;0.607&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 4&lt;/td&gt;&lt;td&gt;0.479&lt;/td&gt;&lt;td&gt;0.635&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="3" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model_summary,</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"text"</span>,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Model Performance Summary"</span>,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Performance Summary
====================
Model   RMSE  Adj_R2
--------------------
Model 1 0.620 0.376 
Model 2 0.491 0.604 
Model 3 0.490 0.607 
Model 4 0.479 0.635 
--------------------</code></pre>
</div>
</div>
<p>#stargazer regression results</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1,model2,model3,model4,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"html"</span>, <span class="co">#could be changed to text if needed</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Model Results"</span>,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">dep.var.labels =</span> <span class="fu">c</span>(<span class="st">"Log of Sale Price"</span>),</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels =</span> <span class="fu">c</span>(</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Log(Total Livable Area)"</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Number of Bedrooms"</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Number of Bathrooms"</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Building Age"</span>,</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Interior Condition"</span>,</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Median Household Income"</span>,</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Family Household Share (Family HH / Total HH)"</span>,</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"% Bachelor's Degree Holders"</span>,</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"% Vacant Housing Units"</span>,</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"% White Population"</span>,</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Economic Density (EconKDE)"</span>,</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Economic Density² (EconKDE²)"</span>,</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Tree Density (TreeKDE)"</span>,</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Mean 3-Nearest Neighbor Distance"</span>,</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Income Q2"</span>,<span class="st">"Income Q3"</span>, <span class="st">"Income Q4"</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"ser"</span>),</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">out =</span> <span class="st">"regression.html"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
&lt;table style="text-align:center"&gt;&lt;caption&gt;&lt;strong&gt;Model Results&lt;/strong&gt;&lt;/caption&gt;
&lt;tr&gt;&lt;td colspan="5" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td colspan="4"&gt;&lt;em&gt;Dependent variable:&lt;/em&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td colspan="4" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td colspan="4"&gt;Log of Sale Price&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(1)&lt;/td&gt;&lt;td&gt;(2)&lt;/td&gt;&lt;td&gt;(3)&lt;/td&gt;&lt;td&gt;(4)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="5" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Log(Total Livable Area)&lt;/td&gt;&lt;td&gt;0.981&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.554&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.535&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.526&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.023)&lt;/td&gt;&lt;td&gt;(0.019)&lt;/td&gt;&lt;td&gt;(0.019)&lt;/td&gt;&lt;td&gt;(0.017)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Number of Bedrooms&lt;/td&gt;&lt;td&gt;-0.154&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.002&lt;/td&gt;&lt;td&gt;0.001&lt;/td&gt;&lt;td&gt;0.005&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.008)&lt;/td&gt;&lt;td&gt;(0.007)&lt;/td&gt;&lt;td&gt;(0.007)&lt;/td&gt;&lt;td&gt;(0.006)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Number of Bathrooms&lt;/td&gt;&lt;td&gt;0.266&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.166&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.164&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.164&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.009)&lt;/td&gt;&lt;td&gt;(0.007)&lt;/td&gt;&lt;td&gt;(0.007)&lt;/td&gt;&lt;td&gt;(0.007)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Building Age&lt;/td&gt;&lt;td&gt;-0.002&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.002&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.001&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.004&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.0002)&lt;/td&gt;&lt;td&gt;(0.0001)&lt;/td&gt;&lt;td&gt;(0.0002)&lt;/td&gt;&lt;td&gt;(0.0004)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Interior Condition&lt;/td&gt;&lt;td&gt;-0.194&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.171&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.178&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.159&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.005)&lt;/td&gt;&lt;td&gt;(0.004)&lt;/td&gt;&lt;td&gt;(0.005)&lt;/td&gt;&lt;td&gt;(0.004)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Median Household Income&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.00000&lt;sup&gt;**&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.00000&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.00000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.00000)&lt;/td&gt;&lt;td&gt;(0.00000)&lt;/td&gt;&lt;td&gt;(0.00000)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Family Household Share (Family HH / Total HH)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.144&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.033&lt;/td&gt;&lt;td&gt;0.077&lt;sup&gt;**&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.035)&lt;/td&gt;&lt;td&gt;(0.037)&lt;/td&gt;&lt;td&gt;(0.036)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;% Bachelor's Degree Holders&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.010&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.012&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.009&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.0004)&lt;/td&gt;&lt;td&gt;(0.0004)&lt;/td&gt;&lt;td&gt;(0.0004)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;% Vacant Housing Units&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;-0.017&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.013&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.011&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.001)&lt;/td&gt;&lt;td&gt;(0.001)&lt;/td&gt;&lt;td&gt;(0.001)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;% White Population&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.006&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.005&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.005&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.0002)&lt;/td&gt;&lt;td&gt;(0.0002)&lt;/td&gt;&lt;td&gt;(0.0002)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Economic Density (EconKDE)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;-15,860.680&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;1,835.694&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(2,421.644)&lt;/td&gt;&lt;td&gt;(2,401.267)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Economic Density² (EconKDE²)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;688,762,600.000&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;149,940,588.000&lt;sup&gt;*&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(85,099,553.000)&lt;/td&gt;&lt;td&gt;(82,710,329.000)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Tree Density (TreeKDE)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;-2,341.584&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-1,444.854&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(380.444)&lt;/td&gt;&lt;td&gt;(375.792)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Mean 3-Nearest Neighbor Distance&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.00000&lt;/td&gt;&lt;td&gt;0.00002&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.00000)&lt;/td&gt;&lt;td&gt;(0.00000)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Income Q2&lt;/td&gt;&lt;td&gt;-0.739&lt;/td&gt;&lt;td&gt;-0.434&lt;/td&gt;&lt;td&gt;-0.458&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.471)&lt;/td&gt;&lt;td&gt;(0.374)&lt;/td&gt;&lt;td&gt;(0.373)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Income Q3&lt;/td&gt;&lt;td&gt;0.025&lt;/td&gt;&lt;td&gt;0.111&lt;/td&gt;&lt;td&gt;0.108&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.175)&lt;/td&gt;&lt;td&gt;(0.139)&lt;/td&gt;&lt;td&gt;(0.139)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Income Q4&lt;/td&gt;&lt;td&gt;0.030&lt;/td&gt;&lt;td&gt;0.070&lt;/td&gt;&lt;td&gt;0.092&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.181)&lt;/td&gt;&lt;td&gt;(0.144)&lt;/td&gt;&lt;td&gt;(0.144)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeA+&lt;/td&gt;&lt;td&gt;0.061&lt;/td&gt;&lt;td&gt;0.114&lt;/td&gt;&lt;td&gt;0.115&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.212)&lt;/td&gt;&lt;td&gt;(0.169)&lt;/td&gt;&lt;td&gt;(0.168)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeB&lt;/td&gt;&lt;td&gt;0.032&lt;/td&gt;&lt;td&gt;0.098&lt;/td&gt;&lt;td&gt;0.112&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.152)&lt;/td&gt;&lt;td&gt;(0.121)&lt;/td&gt;&lt;td&gt;(0.121)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeB-&lt;/td&gt;&lt;td&gt;0.127&lt;/td&gt;&lt;td&gt;0.180&lt;/td&gt;&lt;td&gt;0.195&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.152)&lt;/td&gt;&lt;td&gt;(0.121)&lt;/td&gt;&lt;td&gt;(0.120)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeB+&lt;/td&gt;&lt;td&gt;-0.047&lt;/td&gt;&lt;td&gt;0.025&lt;/td&gt;&lt;td&gt;0.052&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.157)&lt;/td&gt;&lt;td&gt;(0.125)&lt;/td&gt;&lt;td&gt;(0.125)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeC&lt;/td&gt;&lt;td&gt;-0.145&lt;/td&gt;&lt;td&gt;0.165&lt;/td&gt;&lt;td&gt;0.177&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.150)&lt;/td&gt;&lt;td&gt;(0.119)&lt;/td&gt;&lt;td&gt;(0.119)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeC-&lt;/td&gt;&lt;td&gt;-0.103&lt;/td&gt;&lt;td&gt;0.130&lt;/td&gt;&lt;td&gt;0.138&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.152)&lt;/td&gt;&lt;td&gt;(0.121)&lt;/td&gt;&lt;td&gt;(0.120)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeC+&lt;/td&gt;&lt;td&gt;-0.027&lt;/td&gt;&lt;td&gt;0.187&lt;/td&gt;&lt;td&gt;0.199&lt;sup&gt;*&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.150)&lt;/td&gt;&lt;td&gt;(0.120)&lt;/td&gt;&lt;td&gt;(0.119)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeD&lt;/td&gt;&lt;td&gt;0.147&lt;/td&gt;&lt;td&gt;0.187&lt;/td&gt;&lt;td&gt;0.212&lt;sup&gt;*&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.157)&lt;/td&gt;&lt;td&gt;(0.125)&lt;/td&gt;&lt;td&gt;(0.125)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeD-&lt;/td&gt;&lt;td&gt;-0.221&lt;/td&gt;&lt;td&gt;-0.081&lt;/td&gt;&lt;td&gt;-0.065&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.320)&lt;/td&gt;&lt;td&gt;(0.254)&lt;/td&gt;&lt;td&gt;(0.253)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeD+&lt;/td&gt;&lt;td&gt;0.227&lt;/td&gt;&lt;td&gt;0.399&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.406&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.181)&lt;/td&gt;&lt;td&gt;(0.144)&lt;/td&gt;&lt;td&gt;(0.144)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeE&lt;/td&gt;&lt;td&gt;-0.421&lt;sup&gt;**&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;-0.053&lt;/td&gt;&lt;td&gt;-0.012&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.214)&lt;/td&gt;&lt;td&gt;(0.170)&lt;/td&gt;&lt;td&gt;(0.170)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeE-&lt;/td&gt;&lt;td&gt;-0.694&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.144&lt;/td&gt;&lt;td&gt;0.182&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.250)&lt;/td&gt;&lt;td&gt;(0.214)&lt;/td&gt;&lt;td&gt;(0.213)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeE+&lt;/td&gt;&lt;td&gt;-0.369&lt;/td&gt;&lt;td&gt;-0.001&lt;/td&gt;&lt;td&gt;0.030&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.250)&lt;/td&gt;&lt;td&gt;(0.199)&lt;/td&gt;&lt;td&gt;(0.198)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeS&lt;/td&gt;&lt;td&gt;0.071&lt;/td&gt;&lt;td&gt;0.375&lt;/td&gt;&lt;td&gt;0.410&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.471)&lt;/td&gt;&lt;td&gt;(0.374)&lt;/td&gt;&lt;td&gt;(0.373)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;quality_gradeX-&lt;/td&gt;&lt;td&gt;0.372&lt;/td&gt;&lt;td&gt;0.044&lt;/td&gt;&lt;td&gt;-0.005&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.472)&lt;/td&gt;&lt;td&gt;(0.376)&lt;/td&gt;&lt;td&gt;(0.374)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;MHI_quantileQ2&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.162&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.051)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;MHI_quantileQ3&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;-0.026&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.047)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;MHI_quantileQ4 (highest)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;-0.098&lt;sup&gt;**&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.045)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;age:MHI_quantileQ2&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.001&lt;sup&gt;**&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.001)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;age:MHI_quantileQ3&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.003&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.0005)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;age:MHI_quantileQ4 (highest)&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;0.005&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;(0.0005)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Constant&lt;/td&gt;&lt;td&gt;6.300&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;8.106&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;8.378&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;8.613&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;(0.213)&lt;/td&gt;&lt;td&gt;(0.173)&lt;/td&gt;&lt;td&gt;(0.174)&lt;/td&gt;&lt;td&gt;(0.122)&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="5" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Observations&lt;/td&gt;&lt;td&gt;21,269&lt;/td&gt;&lt;td&gt;21,010&lt;/td&gt;&lt;td&gt;21,009&lt;/td&gt;&lt;td&gt;21,196&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;R&lt;sup&gt;2&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.377&lt;/td&gt;&lt;td&gt;0.604&lt;/td&gt;&lt;td&gt;0.607&lt;/td&gt;&lt;td&gt;0.635&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Adjusted R&lt;sup&gt;2&lt;/sup&gt;&lt;/td&gt;&lt;td&gt;0.376&lt;/td&gt;&lt;td&gt;0.604&lt;/td&gt;&lt;td&gt;0.607&lt;/td&gt;&lt;td&gt;0.635&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="5" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;&lt;em&gt;Note:&lt;/em&gt;&lt;/td&gt;&lt;td colspan="4" style="text-align:right"&gt;&lt;sup&gt;*&lt;/sup&gt;p&lt;0.1; &lt;sup&gt;**&lt;/sup&gt;p&lt;0.05; &lt;sup&gt;***&lt;/sup&gt;p&lt;0.01&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1,model2,model3,model4,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"text"</span>, </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Model Results"</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">dep.var.labels =</span> <span class="fu">c</span>(<span class="st">"Log of Sale Price"</span>),</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels =</span> <span class="fu">c</span>(</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Log(Total Livable Area)"</span>,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Number of Bedrooms"</span>,</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Number of Bathrooms"</span>,</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Building Age"</span>,</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Interior Condition"</span>,</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Median Household Income"</span>,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Family Household Share (Family HH / Total HH)"</span>,</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"% Bachelor's Degree Holders"</span>,</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"% Vacant Housing Units"</span>,</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"% White Population"</span>,</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Economic Density (EconKDE)"</span>,</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Economic Density² (EconKDE²)"</span>,</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Tree Density (TreeKDE)"</span>,</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Mean 3-Nearest Neighbor Distance"</span>,</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Income Q2"</span>,<span class="st">"Income Q3"</span>, <span class="st">"Income Q4"</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"ser"</span>),</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Results
=====================================================================================================
                                                                Dependent variable:                  
                                              -------------------------------------------------------
                                                                 Log of Sale Price                   
                                                 (1)       (2)           (3)               (4)       
-----------------------------------------------------------------------------------------------------
Log(Total Livable Area)                       0.981***  0.554***       0.535***          0.526***    
                                               (0.023)   (0.019)       (0.019)           (0.017)     
                                                                                                     
Number of Bedrooms                            -0.154***   0.002         0.001             0.005      
                                               (0.008)   (0.007)       (0.007)           (0.006)     
                                                                                                     
Number of Bathrooms                           0.266***  0.166***       0.164***          0.164***    
                                               (0.009)   (0.007)       (0.007)           (0.007)     
                                                                                                     
Building Age                                  -0.002*** -0.002***     -0.001***         -0.004***    
                                              (0.0002)  (0.0001)       (0.0002)          (0.0004)    
                                                                                                     
Interior Condition                            -0.194*** -0.171***     -0.178***         -0.159***    
                                               (0.005)   (0.004)       (0.005)           (0.004)     
                                                                                                     
Median Household Income                                 0.00000**     0.00000***         -0.00000    
                                                        (0.00000)     (0.00000)         (0.00000)    
                                                                                                     
Family Household Share (Family HH / Total HH)           0.144***        0.033            0.077**     
                                                         (0.035)       (0.037)           (0.036)     
                                                                                                     
% Bachelor's Degree Holders                             0.010***       0.012***          0.009***    
                                                        (0.0004)       (0.0004)          (0.0004)    
                                                                                                     
% Vacant Housing Units                                  -0.017***     -0.013***         -0.011***    
                                                         (0.001)       (0.001)           (0.001)     
                                                                                                     
% White Population                                      0.006***       0.005***          0.005***    
                                                        (0.0002)       (0.0002)          (0.0002)    
                                                                                                     
Economic Density (EconKDE)                                          -15,860.680***      1,835.694    
                                                                     (2,421.644)       (2,401.267)   
                                                                                                     
Economic Density² (EconKDE²)                                      688,762,600.000*** 149,940,588.000*
                                                                   (85,099,553.000)  (82,710,329.000)
                                                                                                     
Tree Density (TreeKDE)                                              -2,341.584***     -1,444.854***  
                                                                      (380.444)         (375.792)    
                                                                                                     
Mean 3-Nearest Neighbor Distance                                       0.00000          0.00002***   
                                                                      (0.00000)         (0.00000)    
                                                                                                     
Income Q2                                      -0.739    -0.434         -0.458                       
                                               (0.471)   (0.374)       (0.373)                       
                                                                                                     
Income Q3                                       0.025     0.111         0.108                        
                                               (0.175)   (0.139)       (0.139)                       
                                                                                                     
Income Q4                                       0.030     0.070         0.092                        
                                               (0.181)   (0.144)       (0.144)                       
                                                                                                     
quality_gradeA+                                 0.061     0.114         0.115                        
                                               (0.212)   (0.169)       (0.168)                       
                                                                                                     
quality_gradeB                                  0.032     0.098         0.112                        
                                               (0.152)   (0.121)       (0.121)                       
                                                                                                     
quality_gradeB-                                 0.127     0.180         0.195                        
                                               (0.152)   (0.121)       (0.120)                       
                                                                                                     
quality_gradeB+                                -0.047     0.025         0.052                        
                                               (0.157)   (0.125)       (0.125)                       
                                                                                                     
quality_gradeC                                 -0.145     0.165         0.177                        
                                               (0.150)   (0.119)       (0.119)                       
                                                                                                     
quality_gradeC-                                -0.103     0.130         0.138                        
                                               (0.152)   (0.121)       (0.120)                       
                                                                                                     
quality_gradeC+                                -0.027     0.187         0.199*                       
                                               (0.150)   (0.120)       (0.119)                       
                                                                                                     
quality_gradeD                                  0.147     0.187         0.212*                       
                                               (0.157)   (0.125)       (0.125)                       
                                                                                                     
quality_gradeD-                                -0.221    -0.081         -0.065                       
                                               (0.320)   (0.254)       (0.253)                       
                                                                                                     
quality_gradeD+                                 0.227   0.399***       0.406***                      
                                               (0.181)   (0.144)       (0.144)                       
                                                                                                     
quality_gradeE                                -0.421**   -0.053         -0.012                       
                                               (0.214)   (0.170)       (0.170)                       
                                                                                                     
quality_gradeE-                               -0.694***   0.144         0.182                        
                                               (0.250)   (0.214)       (0.213)                       
                                                                                                     
quality_gradeE+                                -0.369    -0.001         0.030                        
                                               (0.250)   (0.199)       (0.198)                       
                                                                                                     
quality_gradeS                                  0.071     0.375         0.410                        
                                               (0.471)   (0.374)       (0.373)                       
                                                                                                     
quality_gradeX-                                 0.372     0.044         -0.005                       
                                               (0.472)   (0.376)       (0.374)                       
                                                                                                     
MHI_quantileQ2                                                                           0.162***    
                                                                                         (0.051)     
                                                                                                     
MHI_quantileQ3                                                                            -0.026     
                                                                                         (0.047)     
                                                                                                     
MHI_quantileQ4 (highest)                                                                 -0.098**    
                                                                                         (0.045)     
                                                                                                     
age:MHI_quantileQ2                                                                       0.001**     
                                                                                         (0.001)     
                                                                                                     
age:MHI_quantileQ3                                                                       0.003***    
                                                                                         (0.0005)    
                                                                                                     
age:MHI_quantileQ4 (highest)                                                             0.005***    
                                                                                         (0.0005)    
                                                                                                     
Constant                                      6.300***  8.106***       8.378***          8.613***    
                                               (0.213)   (0.173)       (0.174)           (0.122)     
                                                                                                     
-----------------------------------------------------------------------------------------------------
Observations                                   21,269    21,010         21,009            21,196     
R2                                              0.377     0.604         0.607             0.635      
Adjusted R2                                     0.376     0.604         0.607             0.635      
=====================================================================================================
Note:                                                                     *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
</section>
<section id="coefficient-interpretations" class="level2">
<h2 class="anchored" data-anchor-id="coefficient-interpretations">Coefficient Interpretations</h2>
<p><strong>Structural Features:</strong> - <strong>Log(Total Livable Area) (β = 0.509, p &lt; 0.001)</strong>: A 1% increase in total livable area is associated with a 0.509% increase in sale price, holding all other factors constant. This represents the strongest predictor in our model, indicating that size is the primary driver of housing value in Philadelphia.</p>
<ul>
<li><p><strong>Number of Bedrooms (β = 0.018, p &lt; 0.001)</strong>: Each additional bedroom is associated with approximately a 1.8% increase in sale price. This positive coefficient suggests that bedrooms add value, though the effect is modest compared to other structural features.</p></li>
<li><p><strong>Number of Bathrooms (β = 0.151, p &lt; 0.001)</strong>: Each additional bathroom is associated with approximately a 16.3% increase in sale price. This substantial effect indicates that bathrooms are highly valued amenities in Philadelphia’s housing market, likely reflecting both functional utility and luxury appeal.</p></li>
<li><p><strong>Building Age (β = -0.004, p &lt; 0.001)</strong>: Each additional year of building age is associated with approximately a 0.4% decrease in sale price. This suggests that newer homes command premium prices, reflecting depreciation over time and the value of modern amenities and construction standards.</p></li>
<li><p><strong>Interior Condition (β = -0.164, p &lt; 0.001)</strong>: Each unit increase in interior condition rating (where higher numbers indicate worse condition) is associated with approximately a 17.9% decrease in sale price. This substantial effect demonstrates the critical importance of property condition in determining market value.</p></li>
</ul>
<p><strong>Neighborhood Demographics:</strong> - <strong>Median Household Income (β = 0.00000, p &lt; 0.1)</strong>: While statistically significant, the coefficient is extremely small, suggesting that tract-level median income has a minimal direct effect on individual property prices when controlling for other factors.</p>
<ul>
<li><p><strong>% Bachelor’s Degree Holders (β = 0.008, p &lt; 0.001)</strong>: A 1 percentage point increase in the proportion of residents with bachelor’s degrees is associated with approximately a 0.8% increase in sale price. This reflects the premium associated with highly educated neighborhoods or higher ability to pay for degree-holding buyers.</p></li>
<li><p><strong>% Vacant Housing Units (β = -0.011, p &lt; 0.001)</strong>: A 1 percentage point increase in vacancy rate is associated with approximately a 1.1% decrease in sale price. This negative relationship reflects the detrimental effects of neighborhood blight and disinvestment on property values.</p></li>
<li><p><strong>% White Population (β = 0.004, p &lt; 0.001)</strong>: A 1 percentage point increase in the white population share is associated with approximately a 0.4% increase in sale price. This coefficient likely captures both historical patterns of neighborhood investment and ongoing racial disparities in housing markets.</p></li>
</ul>
<p><strong>Spatial Features:</strong> - <strong>Economic Density (EconKDE) (β = -3,726.664, p &lt; 0.001)</strong>: The linear term shows a negative coefficient, suggesting that at low levels of economic activity, proximity to commercial areas may initially depress housing values, possibly due to noise, traffic, or other negative externalities.</p>
<ul>
<li><p><strong>Economic Density² (EconKDE²) (β = 26,476,926, p &lt; 0.001)</strong>: The positive quadratic term indicates that the relationship between economic density and housing prices is U-shaped. As economic activity increases beyond a certain threshold, the benefits of proximity to amenities, employment, and urban vibrancy begin to outweigh the costs, leading to premium pricing in highly commercial areas.</p></li>
<li><p><strong>Mean 3-Nearest Neighbor Distance (β = 0.00002, p &lt; 0.001)</strong>: The positive coefficient suggests that properties located farther from their three nearest neighbors command slightly higher prices, possibly reflecting larger lot sizes or more exclusive locations.</p></li>
</ul>
<p><strong>Income Quantile Effects:</strong> - <strong>MHI_quantileQ2 (β = 0.136, p &lt; 0.001)</strong>: Properties in the second income quartile neighborhoods command approximately 14.6% higher prices than those in the lowest quartile, reflecting the premium associated with middle-income areas.</p>
<ul>
<li><strong>Age-Income Interactions</strong>: The positive interaction terms between age and higher income quantiles (Q2: β = 0.001, Q3: β = 0.003, Q4: β = 0.004) suggest that older homes retain more value in wealthier neighborhoods, likely due to better maintenance, historic preservation, or neighborhood character that offsets age-related depreciation.</li>
</ul>
<p>The economic density relationship is particularly noteworthy—it demonstrates that Philadelphia’s housing market exhibits a complex spatial pattern where moderate commercial activity may initially depress values, but high-density commercial areas (like Center City) command significant premiums, reflecting the urban amenities premium that characterizes successful city centers.</p>
<p>#Phase 5: Model Validation</p>
<section id="set-up-10-fold-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="set-up-10-fold-cross-validation">Set up 10-fold cross-validation</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(for_model_building)), <span class="at">breaks =</span> k, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cv-for-model-1" class="level3">
<h3 class="anchored" data-anchor-id="cv-for-model-1">CV for Model 1</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>rmse_cv_1 <span class="ot">&lt;-</span> mae_cv_1 <span class="ot">&lt;-</span> r2_cv_1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  cv_train <span class="ot">&lt;-</span> for_model_building[<span class="sc">-</span>test_indices, ]</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  cv_test <span class="ot">&lt;-</span> for_model_building[test_indices, ]</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fit model</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>interior_condition<span class="sc">+</span>quality_grade, <span class="at">data =</span> cv_train)</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> cv_test)</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate metrics</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>  rmse_cv_1[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>  mae_cv_1[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>  ss_res <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>  ss_tot <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> <span class="fu">mean</span>(cv_test<span class="sc">$</span>log_price))<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>  r2_cv_1[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_res <span class="sc">/</span> ss_tot)</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="dv">1</span><span class="sc">:</span>k, <span class="at">RMSE =</span> <span class="fu">round</span>(rmse_cv_1, <span class="dv">4</span>), </span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MAE =</span> <span class="fu">round</span>(mae_cv_1, <span class="dv">4</span>), <span class="at">R2 =</span> <span class="fu">round</span>(r2_cv_1, <span class="dv">4</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fold   RMSE    MAE     R2
1     1 0.6278 0.4694 0.4359
2     2 0.6245 0.4671 0.4024
3     3 0.6604 0.4909 0.3656
4     4 0.6118 0.4516 0.4485
5     5 0.6269 0.4615 0.4088
6     6 0.7364 0.5297 0.2180
7     7 0.6241 0.4548 0.4098
8     8 0.5964 0.4472 0.4341
9     9 0.5845 0.4319 0.4567
10   10 0.6210 0.4559 0.4351</code></pre>
</div>
</div>
</section>
<section id="cv-for-model-2" class="level3">
<h3 class="anchored" data-anchor-id="cv-for-model-2">CV for Model 2</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>rmse_cv_2 <span class="ot">&lt;-</span> mae_cv_2 <span class="ot">&lt;-</span> r2_cv_2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  cv_train <span class="ot">&lt;-</span> for_model_building[<span class="sc">-</span>test_indices, ]</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  cv_test <span class="ot">&lt;-</span> for_model_building[test_indices, ]</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fit model</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>quality_grade, <span class="at">data =</span> cv_train)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> cv_test)</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate metrics</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>  rmse_cv_2[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>  mae_cv_2[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>  ss_res <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>  ss_tot <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> <span class="fu">mean</span>(cv_test<span class="sc">$</span>log_price))<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>  r2_cv_2[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_res <span class="sc">/</span> ss_tot)</span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="dv">1</span><span class="sc">:</span>k, <span class="at">RMSE =</span> <span class="fu">round</span>(rmse_cv_2, <span class="dv">4</span>), </span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MAE =</span> <span class="fu">round</span>(mae_cv_2, <span class="dv">4</span>), <span class="at">R2 =</span> <span class="fu">round</span>(r2_cv_2, <span class="dv">4</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fold   RMSE    MAE     R2
1     1 0.4887 0.3419 0.6638
2     2 0.4979 0.3429 0.6251
3     3 0.5214 0.3466 0.6086
4     4 0.4729 0.3245 0.6749
5     5 0.4815 0.3205 0.6549
6     6 0.6779 0.4323 0.3466
7     7 0.4920 0.3290 0.6375
8     8 0.4354 0.3062 0.7013
9     9 0.4443 0.3098 0.6895
10   10 0.4834 0.3275 0.6616</code></pre>
</div>
</div>
</section>
<section id="cv-for-model-3" class="level3">
<h3 class="anchored" data-anchor-id="cv-for-model-3">CV for Model 3</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>rmse_cv_3 <span class="ot">&lt;-</span> mae_cv_3 <span class="ot">&lt;-</span> r2_cv_3 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  cv_train <span class="ot">&lt;-</span> for_model_building[<span class="sc">-</span>test_indices, ]</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  cv_test <span class="ot">&lt;-</span> for_model_building[test_indices, ]</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fit model</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>TreeKDE</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>mean_3nn_dist<span class="sc">+</span>quality_grade, <span class="at">data =</span> cv_train)</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> cv_test)</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate metrics</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>  rmse_cv_3[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>  mae_cv_3[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>  ss_res <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>  ss_tot <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> <span class="fu">mean</span>(cv_test<span class="sc">$</span>log_price))<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>  r2_cv_3[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_res <span class="sc">/</span> ss_tot)</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="dv">1</span><span class="sc">:</span>k, <span class="at">RMSE =</span> <span class="fu">round</span>(rmse_cv_3, <span class="dv">4</span>), </span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MAE =</span> <span class="fu">round</span>(mae_cv_3, <span class="dv">4</span>), <span class="at">R2 =</span> <span class="fu">round</span>(r2_cv_3, <span class="dv">4</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fold   RMSE    MAE     R2
1     1 0.4865 0.3394 0.6668
2     2 0.4946 0.3392 0.6301
3     3 0.5182 0.3443 0.6134
4     4 0.4703 0.3221 0.6786
5     5 0.4793 0.3194 0.6580
6     6 0.6799 0.4318 0.3429
7     7 0.4891 0.3267 0.6417
8     8 0.4330 0.3047 0.7046
9     9 0.4415 0.3073 0.6934
10   10 0.4822 0.3259 0.6633</code></pre>
</div>
</div>
</section>
<section id="cv-for-model-4" class="level3">
<h3 class="anchored" data-anchor-id="cv-for-model-4">CV for Model 4</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>rmse_cv_4 <span class="ot">&lt;-</span> mae_cv_4 <span class="ot">&lt;-</span> r2_cv_4 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  cv_train <span class="ot">&lt;-</span> for_model_building[<span class="sc">-</span>test_indices, ]</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  cv_test <span class="ot">&lt;-</span> for_model_building[test_indices, ]</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fit model</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_price<span class="sc">~</span>log_total_livable_area<span class="sc">+</span>number_of_bedrooms<span class="sc">+</span>number_of_bathrooms<span class="sc">+</span>age</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>interior_condition<span class="sc">+</span>median_income<span class="sc">+</span><span class="fu">I</span>(family_hh<span class="sc">/</span>total_hh)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>pct_bachelors<span class="sc">+</span>pct_vacant<span class="sc">+</span>pct_white<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>TreeKDE</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span>mean_3nn_dist<span class="sc">+</span>MHI_quantile<span class="sc">*</span>age, <span class="at">data =</span> cv_train)</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> cv_test)</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate metrics</span></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>  rmse_cv_4[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>  mae_cv_4[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>  ss_res <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>  ss_tot <span class="ot">&lt;-</span> <span class="fu">sum</span>((cv_test<span class="sc">$</span>log_price <span class="sc">-</span> <span class="fu">mean</span>(cv_test<span class="sc">$</span>log_price))<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>  r2_cv_4[i] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_res <span class="sc">/</span> ss_tot)</span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>(<span class="at">Fold =</span> <span class="dv">1</span><span class="sc">:</span>k, <span class="at">RMSE =</span> <span class="fu">round</span>(rmse_cv_4, <span class="dv">4</span>), </span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MAE =</span> <span class="fu">round</span>(mae_cv_4, <span class="dv">4</span>), <span class="at">R2 =</span> <span class="fu">round</span>(r2_cv_4, <span class="dv">4</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fold   RMSE    MAE     R2
1     1 0.4744 0.3291 0.6810
2     2 0.4839 0.3282 0.6445
3     3 0.5022 0.3301 0.6316
4     4 0.4524 0.3067 0.6983
5     5 0.4631 0.3054 0.6770
6     6 0.6751 0.4182 0.3491
7     7 0.4759 0.3153 0.6573
8     8 0.4200 0.2920 0.7218
9     9 0.4260 0.2908 0.7128
10   10 0.4650 0.3095 0.6822</code></pre>
</div>
</div>
</section>
<section id="cv-results-summary" class="level3">
<h3 class="anchored" data-anchor-id="cv-results-summary">CV Results Summary</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>cv_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Model 1"</span>, <span class="st">"Model 2"</span>, <span class="st">"Model 3"</span>, <span class="st">"Model 4"</span>),</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV_RMSE =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">mean</span>(rmse_cv_1), <span class="fu">mean</span>(rmse_cv_2), <span class="fu">mean</span>(rmse_cv_3), <span class="fu">mean</span>(rmse_cv_4)), <span class="dv">3</span>),</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV_MAE =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">mean</span>(mae_cv_1), <span class="fu">mean</span>(mae_cv_2), <span class="fu">mean</span>(mae_cv_3), <span class="fu">mean</span>(mae_cv_4)), <span class="dv">3</span>),</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV_R2 =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">mean</span>(r2_cv_1), <span class="fu">mean</span>(r2_cv_2), <span class="fu">mean</span>(r2_cv_3), <span class="fu">mean</span>(r2_cv_4)), <span class="dv">3</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(cv_summary,</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"text"</span>,</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"10-Fold Cross-Validation Results"</span>,</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
10-Fold Cross-Validation Results
============================
Model   CV_RMSE CV_MAE CV_R2
----------------------------
Model 1  0.631  0.466  0.401
Model 2  0.500  0.338  0.626
Model 3  0.497  0.336  0.629
Model 4  0.484  0.323  0.646
----------------------------</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(cv_summary,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">"html"</span>,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"10-Fold Cross-Validation Results"</span>,</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">out =</span> <span class="st">"cv_results.html"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
&lt;table style="text-align:center"&gt;&lt;caption&gt;&lt;strong&gt;10-Fold Cross-Validation Results&lt;/strong&gt;&lt;/caption&gt;
&lt;tr&gt;&lt;td colspan="4" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Model&lt;/td&gt;&lt;td&gt;CV_RMSE&lt;/td&gt;&lt;td&gt;CV_MAE&lt;/td&gt;&lt;td&gt;CV_R2&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="4" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 1&lt;/td&gt;&lt;td&gt;0.631&lt;/td&gt;&lt;td&gt;0.466&lt;/td&gt;&lt;td&gt;0.401&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 2&lt;/td&gt;&lt;td&gt;0.500&lt;/td&gt;&lt;td&gt;0.338&lt;/td&gt;&lt;td&gt;0.626&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 3&lt;/td&gt;&lt;td&gt;0.497&lt;/td&gt;&lt;td&gt;0.336&lt;/td&gt;&lt;td&gt;0.629&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td style="text-align:left"&gt;Model 4&lt;/td&gt;&lt;td&gt;0.484&lt;/td&gt;&lt;td&gt;0.323&lt;/td&gt;&lt;td&gt;0.646&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="4" style="border-bottom: 1px solid black"&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</code></pre>
</div>
</div>
</section>
<section id="detailed-cv-results-by-fold" class="level3">
<h3 class="anchored" data-anchor-id="detailed-cv-results-by-fold">Detailed CV Results by Fold</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show detailed fold-by-fold performance for model 4</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>detailed_cv <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fold =</span> <span class="dv">1</span><span class="sc">:</span>k,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">round</span>(rmse_cv_4, <span class="dv">4</span>),</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE =</span> <span class="fu">round</span>(mae_cv_4, <span class="dv">4</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2 =</span> <span class="fu">round</span>(r2_cv_4, <span class="dv">4</span>)</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(detailed_cv)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fold   RMSE    MAE     R2
1     1 0.4744 0.3291 0.6810
2     2 0.4839 0.3282 0.6445
3     3 0.5022 0.3301 0.6316
4     4 0.4524 0.3067 0.6983
5     5 0.4631 0.3054 0.6770
6     6 0.6751 0.4182 0.3491
7     7 0.4759 0.3153 0.6573
8     8 0.4200 0.2920 0.7218
9     9 0.4260 0.2908 0.7128
10   10 0.4650 0.3095 0.6822</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics across folds</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Model 4 CV Performance Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model 4 CV Performance Summary:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE: Mean ="</span>, <span class="fu">round</span>(<span class="fu">mean</span>(rmse_cv_4), <span class="dv">4</span>), <span class="st">", SD ="</span>, <span class="fu">round</span>(<span class="fu">sd</span>(rmse_cv_4), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: Mean = 0.4838 , SD = 0.0717 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:  Mean ="</span>, <span class="fu">round</span>(<span class="fu">mean</span>(mae_cv_4), <span class="dv">4</span>), <span class="st">", SD ="</span>, <span class="fu">round</span>(<span class="fu">sd</span>(mae_cv_4), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE:  Mean = 0.3225 , SD = 0.0365 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R²:   Mean ="</span>, <span class="fu">round</span>(<span class="fu">mean</span>(r2_cv_4), <span class="dv">4</span>), <span class="st">", SD ="</span>, <span class="fu">round</span>(<span class="fu">sd</span>(r2_cv_4), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R²:   Mean = 0.6456 , SD = 0.108 </code></pre>
</div>
</div>
<p>###Predicted vs.&nbsp;Actual Plot</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generate predictions using model4</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>final_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model4, <span class="at">newdata =</span> for_model_building)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create scatter plot</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(for_model_building<span class="sc">$</span>log_price, final_predictions,</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Actual Log(Sale Price)"</span>,</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Predicted Log(Sale Price)"</span>,</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Predicted vs. Actual Sale Prices"</span>,</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.3</span>))</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="feature-importance-analysis" class="level3">
<h3 class="anchored" data-anchor-id="feature-importance-analysis">Feature Importance Analysis</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model4)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">names</span>(coefs),</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(coefs), <span class="dv">4</span>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(feature_importance)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Feature    Coefficient
1        log_total_livable_area         0.5259
2            number_of_bedrooms         0.0048
3           number_of_bathrooms         0.1642
4                           age        -0.0043
5            interior_condition        -0.1589
6                 median_income         0.0000
7         I(family_hh/total_hh)         0.0772
8                 pct_bachelors         0.0087
9                    pct_vacant        -0.0110
10                    pct_white         0.0047
11                      EconKDE      1835.6937
12                 I(EconKDE^2) 149940588.0799
13                      TreeKDE     -1444.8536
14                mean_3nn_dist         0.0000
15               MHI_quantileQ2         0.1616
16               MHI_quantileQ3        -0.0255
17     MHI_quantileQ4 (highest)        -0.0977
18           age:MHI_quantileQ2         0.0012
19           age:MHI_quantileQ3         0.0027
20 age:MHI_quantileQ4 (highest)         0.0045</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The most important feature is I(EconKDE^2). It has the largest coefficient compared for all the other features. This reflects that being close to commerical activities is really important to housing prices. There is also a pattern that spatial features are important.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>#Phase 6: Model Diagnostics</p>
</section>
</section>
<section id="diagnostic-plots-for-best-model" class="level2">
<h2 class="anchored" data-anchor-id="diagnostic-plots-for-best-model">Diagnostic Plots for Best Model</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generate diagnostic plots</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-56-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-56-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-56-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Residual Plot:</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co">#The Residuals vs Fitted plot shows mild heteroskedasticity and a small degree of curvature, which is expected in a dataset of this size, and the model performs consistently well across most of the fitted range with only a few isolated outliers.</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co">#QQ-Plot:</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">#The Q-Q plot shows slight deviation from normality in the extreme tails, which is common in large real-world housing datasets, while the majority of residuals align closely with the theoretical normal distribution, indicating that model inference remains reliable.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cooks-distance-plot" class="level2">
<h2 class="anchored" data-anchor-id="cooks-distance-plot">Cook’s Distance Plot</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#identify influential observations</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>cooks_d <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(model4)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cooks_d, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">main =</span> <span class="st">"Cook's Distance"</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Cook's Distance"</span>, <span class="at">xlab =</span> <span class="st">"Observation"</span>)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">4</span><span class="sc">/</span><span class="fu">nrow</span>(for_model_building), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="appendix_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The Cook’s Distance plot shows that while a few observations exert relatively higher influence on the regression model, the vast majority of cases have negligible influence, and no single data point appears to unduly distort the model’s estimated coefficients.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>#Phase 7: Conclusions &amp; Recommendations</p>
<p>Our final model’s is able to explain 64% of the variation on <em>logged</em> (is this right way to describe this?) house prices in Philadelphia, with an average error of 48.31%. Our residuals mostly fall along the Q-Q plot’s line and are homoscadestic (as seen in the Scale-Location plot), meaning that the residuals both fall on a normal distribution and the variance of residuals is consistent across all independent variable values. Our K-folds analysis returned an R2 of .65 (higher than the model’s original .64), illustrating our model’s efficacy with non-test data. The feature that matters most is the economic density around the examined housing unit, as it first has a positive relationship with housing price and then has a negative relationship.</p>
<p>Hardest neighborhoods to predict are the most affluent areas — as the social connotations of these spaces are both largely influential in housing prices as well as unquantifiable. Becuase of historical underdevelopment and the history of how that is tied to both race and class, housing prices are intrinsically tied to these vulnerable groups. A model that predicts housing prices is also convincing developers to focus on already well-to-do neighborhoods, whether it be when building housing or commercial centers. There are pros and cons to this, as it may protect neighborhoods from gentrification, but it could also exclude them from capital infusions and access to goods/services. Our model is limited in numerous ways, one of which is the inability to quantify power of word of mouth. For example, once the general vibe around a neighborhood — such as Fishtown — changes from working class (or from another marginalized group) to “up and coming” or “hip”, future housing prices in the area may radically change. Another limitation is the non-incorporation of Philadelphia’s future plans. For example, if the Roosevelt Boulevard extension was to begin construction, then our model would be unable to predict the change in housing price until the stations were built and the local impacts began.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>